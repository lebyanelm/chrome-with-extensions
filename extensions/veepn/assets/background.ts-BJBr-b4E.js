var Tr=Object.defineProperty;var Mr=(t,e,s)=>e in t?Tr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var A=(t,e,s)=>Mr(t,typeof e!="symbol"?e+"":e,s);import{b as B,m as Ve,S as xn}from"./index-Cmg072g4.js";import{E as Ut,a as ie,b as gt,c as Me,n as ve,d as Ie,g as se,e as En,f as An,u as fe,w as Cn,h as Rn,j as Ke,k as mt,p as Vt,l as Pe,z as R,S as ue,m as Kt,U as Yt,A as Xt,o as Qt,q as yt}from"./index-BHXggChp.js";import{l as _n,c as Zt,a as Ir,b as Pr,d as Br,e as Or}from"./index-Clmvzsr_.js";function Nr(t){return/https?:\/\/(?:www\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b)*(\/[\/\d\w\.-]*)*(?:[\?])*(.+)*/gi.test(t)}class Fr{constructor(e,s,n,r,i,a,o,c,u,l,d,f,h,g,w){this.analyticsService=e,this.accessService=s,this.appService=n,this.notificationService=r,this.i18nService=i,this.globalStateService=a,this.apiFreeService=o,this.apiPremiumService=c,this.userService=u,this.webrtcService=l,this.exclusionsService=d,this.abTestsService=f,this.eventService=h,this.proxyService=g,this.connectionService=w}async uninstallSelf(){return await Promise.resolve(this),await B.management.uninstallSelf(),{success:!0,data:{success:!0}}}async refreshSelf(){await this.proxyService.disable();const e=this.eventService.dispatch({reset:void 0});return await Promise.all(e),B.runtime.reload(),{success:!0,data:{success:!0}}}async getAnalyticPrivacy(){return await Promise.resolve(),{success:!0,data:{show:this.analyticsService.needPrivacyAcceptance}}}async setAnalyticPrivacy(e){return await this.analyticsService.setPrivacy(e),await this.accessService.setUninstallURL(),(await B.tabs.query({})).filter(r=>{var i;return(i=r.url)==null?void 0:i.includes("src/pages/consent-settings/index.html")}).forEach(r=>{r!=null&&r.id&&B.tabs.remove(r.id).catch(()=>{})}),await this.accessService.proceedToWebsitePage({page:"install",params:{utm_campaign:"welcome"}}),{success:!0,data:{success:!0}}}async sendAnalyticEvent(e){return await Promise.resolve(),this.analyticsService.sendEvent(e),{success:!0,data:{success:!0}}}async showWebsitePage(e){return await this.accessService.proceedToWebsitePage(e),{success:!0,data:{success:!0}}}async setColorTheme(e){return await this.appService.setColorTheme(e),{success:!0,data:{success:!0}}}async getAppData(){return await Promise.resolve(),{success:!0,data:{version:this.appService.version,theme:this.appService.colorTheme}}}async getShowOnboarding(){return await Promise.resolve(),{success:!0,data:{show:this.appService.showOnboarding}}}async closeOnboarding(){return await this.appService.setShowOnboarding(!1),{success:!0,data:{success:!0}}}async setActiveLocale(e){return await this.i18nService.setLocale(e),{success:!0,data:{success:!0}}}async getActiveLocale(){return await Promise.resolve(),{success:!0,data:{locale:this.i18nService.activeLocale}}}async getLanguageList(){return await Promise.resolve(),{success:!0,data:{list:this.i18nService.languageList}}}async getNotificationPermition(){return await Promise.resolve(),{success:!0,data:{permition:this.notificationService.permition}}}async setNotificationPermition(e){return await this.notificationService.setNotificationPermition(e),{success:!0,data:{success:!0}}}async getSessionCount(){return await Promise.resolve(),{success:!0,data:{count:this.appService.sessionCount}}}async incrementSessionCount(){return await this.appService.incrementSessionCount(),{success:!0,data:{success:!0}}}async getDownloadLink(e){return{success:!0,data:{link:await this.appService.getDownloadLink(e)}}}async getBlockAds(){return await Promise.resolve(),{success:!0,data:{status:this.appService.isBlockAds}}}async setBlockAds(e){return await this.appService.setBlockAds(e.status),{success:!0,data:{success:!0}}}async setDeviceScreenData(e){return await this.globalStateService.setDeviceScreenData(e),{success:!0,data:{success:!0}}}async getRateUsData(){return await Promise.resolve(),{success:!0,data:this.appService.rateUsData}}async incrementRateUsData(){return await this.appService.incrementRateUs(),{success:!0,data:{success:!0}}}async showExtensionStore(){const s={platform:"chrome"},n=this.userService.hasPermitions("domain","premium")?await this.apiPremiumService.fetch({method:"POST",url:"apiUrlReview",body:s}):await this.apiFreeService.fetch({method:"POST",url:"apiUrlReview",body:s}),r=n.success?n.data.url:this.appService.extensionStoreUrl;return await B.tabs.create({url:r}),{success:!0,data:{success:!0}}}async getBlockWebrtc(){return await Promise.resolve(),{success:!0,data:{status:this.webrtcService.isApplied}}}async enableBlockWebrtc(){const e=await this.webrtcService.enable();return e.status?(await this.webrtcService.setBlockWebrtc(!0),{success:!0,data:{success:!0}}):{success:!1,errors:[{code:0,status:0,name:"",message:e.cause==="not_controllable"?this.i18nService.t("base:webrtc-errors.not-controllable"):this.i18nService.t("base:webrtc-errors.controlled-by-other-extensions")}]}}async disableBlockWebrtc(){return await this.webrtcService.disable()?(await this.webrtcService.setBlockWebrtc(!1),{success:!0,data:{success:!0}}):{success:!1,errors:[{code:0,status:0,name:"",message:this.i18nService.t("base:webrtc-errors.remove-webrtc")}]}}async getActiveTabInfo(){await Promise.resolve(this);const s=(await B.tabs.query({currentWindow:!0,active:!0})).at(0);if(!s||!s.url)return{success:!0,data:{info:null}};if(!Nr(s.url))return{success:!0,data:{info:null}};const{hostname:r}=new URL(s.url);return{success:!0,data:{info:{matchPattern:r,favicon:s.favIconUrl}}}}async getExclusionSites(){return await Promise.resolve(),{success:!0,data:{list:this.exclusionsService.exclusionSites}}}async addExclusionSite(e){return await this.exclusionsService.add(e),{success:!0,data:{success:!0}}}async removeExclusionSite(e){return await this.exclusionsService.remove(e),{success:!0,data:{success:!0}}}async closeConnectionSurvey(){return await this.appService.closeConnectionSurvey(),{success:!0,data:{success:!0}}}async incrementConnectionSurvey(){return await this.appService.incrementConnectionSurvey(),{success:!0,data:{success:!0}}}async delayConnectionSurvey(){return await this.appService.delayConnectionSurvey(),{success:!0,data:{success:!0}}}async disableConnectionSurvey(){return await this.appService.disableConnectionSurvey(),{success:!0,data:{success:!0}}}async getConnectionSurvey(){return await Promise.resolve(),{success:!0,data:{close:this.appService.connectionSurveyClose,needShow:this.appService.needShowConnectionSurvey}}}async getDiscountBanner(){await Promise.resolve();const e=1e3*60*60*24*62,s=this.globalStateService.installedAt+e<Date.now();return{success:!0,data:{active:this.abTestsService.getExperimentStatus(Ut.discount60off).active&&s}}}async getBanner2Session(){await Promise.resolve();const{banner2Session:e,sessionCount:s}=this.appService,n=e.active&&s>2;if(n){const r=await this.getBanner3Connection();r.success&&r.data.active&&await this.disableBanner3Connection();const i=await this.getBanner15Connection();i.success&&i.data.active&&await this.disableBanner15Connection()}return{success:!0,data:{active:n}}}async disableBanner2Session(){return await this.appService.disableBanner2Session(),{success:!0,data:{success:!0}}}async getBanner3Connection(){await Promise.resolve();const{banner3Connection:e}=this.appService,n=this.connectionService.connectionCount===3;return{success:!0,data:{active:e.active&&n}}}async disableBanner3Connection(){return await this.appService.disableBanner3Connection(),{success:!0,data:{success:!0}}}async getBanner15Connection(){await Promise.resolve();const{banner15Connection:e}=this.appService,n=this.connectionService.connectionCount===15;return{success:!0,data:{active:e.active&&n}}}async disableBanner15Connection(){return await this.appService.disableBanner15Connection(),{success:!0,data:{success:!0}}}async getBanner14Days(){await Promise.resolve(),this.appService.banner14Days.nextTimestamp<Date.now()&&await this.appService.activateBanner14Days();const{banner14Days:s}=this.appService,n=s.active;if(n){const r=await this.getBanner2Session();r.success&&r.data.active&&await this.disableBanner2Session();const i=await this.getBanner3Connection();i.success&&i.data.active&&await this.disableBanner3Connection();const a=await this.getBanner15Connection();a.success&&a.data.active&&await this.disableBanner15Connection()}return{success:!0,data:{active:n}}}async disableBanner14Days(){return await this.appService.disableBanner14Days(),{success:!0,data:{success:!0}}}async getBanner16Days(){var a;await Promise.resolve();const e=(a=this.appService.geolocation)==null?void 0:a.country,s=e!=="ir"&&e!=="ru",{banner16Days:n}=this.appService,r=n.nextTimestamp<Date.now(),i=s&&n.active&&r;if(i){const o=await this.getBanner2Session();o.success&&o.data.active&&await this.disableBanner2Session();const c=await this.getBanner3Connection();c.success&&c.data.active&&await this.disableBanner3Connection();const u=await this.getBanner15Connection();u.success&&u.data.active&&await this.disableBanner15Connection();const l=await this.getBanner14Days();l.success&&l.data.active&&await this.disableBanner14Days()}return{success:!0,data:{active:i}}}async disableBanner16Days(){return await this.appService.disableBanner16Days(),{success:!0,data:{success:!0}}}}class Lr{constructor(e,s){this.messageService=e,this.appController=s}init(){this.messageService.subscribe({"uninstall-self":this.uninstallSelf.bind(this),"refresh-self":this.refreshSelf.bind(this),"hold-active-ping":this.holdActivePing.bind(this),"send-analytic-event":this.sendAnalyticEvent.bind(this),"get-analytic-privacy":this.getAnalyticPrivacy.bind(this),"set-analytic-privacy":this.setAnalyticPrivacy.bind(this),"show-website-page":this.showWebsitePage.bind(this),"set-color-theme":this.setColorTheme.bind(this),"get-app-data":this.getAppData.bind(this),"get-show-onboarding":this.getShowOnboarding.bind(this),"close-onboarding":this.closeOnboarding.bind(this),"set-active-locale":this.setActiveLocale.bind(this),"get-active-locale":this.getActiveLocale.bind(this),"get-language-list":this.getLanguageList.bind(this),"set-notification-permition":this.setNotificationPermition.bind(this),"get-notification-permition":this.getNotificationPermition.bind(this),"get-session-count":this.getSessionCount.bind(this),"increment-session-count":this.incrementSessionCount.bind(this),"get-download-link":this.getDownloadLink.bind(this),"get-block-ads":this.getBlockAds.bind(this),"set-block-ads":this.setBlockAds.bind(this),"set-device-screen":this.setDeviceScreenData.bind(this),"get-rate-us":this.getRateUsData.bind(this),"increment-rate-us":this.incrementRateUsData.bind(this),"show-extension-store":this.showExtensionStore.bind(this),"get-block-webrtc":this.getBlockWebrtc.bind(this),"enable-block-webrtc":this.enableBlockWebrtc.bind(this),"disable-block-webrtc":this.disableBlockWebrtc.bind(this),"get-active-tab-info":this.getActiveTabInfo.bind(this),"get-exclusion-sites":this.getExclusionSites.bind(this),"add-exclusion-site":this.addExclusionSite.bind(this),"remove-exclusion-site":this.removeExclusionSite.bind(this),"close-connection-survey":this.closeConnectionSurvey.bind(this),"increment-connection-survey":this.incrementConnectionSurvey.bind(this),"delay-connection-survey":this.delayConnectionSurvey.bind(this),"disable-connection-survey":this.disableConnectionSurvey.bind(this),"get-connection-survey":this.getConnectionSurvey.bind(this),"get-discount-banner-state":this.getDiscountBanner.bind(this),"get-banner-2-session":this.getBanner2Session.bind(this),"disable-banner-2-session":this.disableBanner2Session.bind(this),"get-banner-3-connection":this.getBanner3Connection.bind(this),"disable-banner-3-connection":this.disableBanner3Connection.bind(this),"get-banner-15-connection":this.getBanner15Connection.bind(this),"disable-banner-15-connection":this.disableBanner15Connection.bind(this),"get-banner-14-days":this.getBanner14Days.bind(this),"disable-banner-14-days":this.disableBanner14Days.bind(this),"get-banner-16-days":this.getBanner16Days.bind(this),"disable-banner-16-days":this.disableBanner16Days.bind(this)})}async uninstallSelf(){return{...await this.appController.uninstallSelf(),type:"uninstall-self"}}async refreshSelf(){return{...await this.appController.refreshSelf(),type:"refresh-self"}}async holdActivePing(){return await Promise.resolve(this),{type:"hold-active-ping",success:!0,data:{success:!0}}}async setAnalyticPrivacy(e){return{...await this.appController.setAnalyticPrivacy(e),type:"set-analytic-privacy"}}async getAnalyticPrivacy(){return{...await this.appController.getAnalyticPrivacy(),type:"get-analytic-privacy"}}async sendAnalyticEvent(e){return{...await this.appController.sendAnalyticEvent(e),type:"send-analytic-event"}}async showWebsitePage(e){return{...await this.appController.showWebsitePage(e),type:"show-website-page"}}async setColorTheme(e){return{...await this.appController.setColorTheme(e),type:"set-color-theme"}}async getAppData(){return{...await this.appController.getAppData(),type:"get-app-data"}}async getShowOnboarding(){return{...await this.appController.getShowOnboarding(),type:"get-show-onboarding"}}async closeOnboarding(){return{...await this.appController.closeOnboarding(),type:"close-onboarding"}}async setActiveLocale(e){return{...await this.appController.setActiveLocale(e),type:"set-active-locale"}}async getActiveLocale(){return{...await this.appController.getActiveLocale(),type:"get-active-locale"}}async getLanguageList(){return{...await this.appController.getLanguageList(),type:"get-language-list"}}async setNotificationPermition(e){return{...await this.appController.setNotificationPermition(e),type:"set-notification-permition"}}async getNotificationPermition(){return{...await this.appController.getNotificationPermition(),type:"get-notification-permition"}}async getSessionCount(){return{...await this.appController.getSessionCount(),type:"get-session-count"}}async incrementSessionCount(){return{...await this.appController.incrementSessionCount(),type:"increment-session-count"}}async getDownloadLink(e){return{...await this.appController.getDownloadLink(e),type:"get-download-link"}}async getBlockAds(){return{...await this.appController.getBlockAds(),type:"get-block-ads"}}async setBlockAds(e){return{...await this.appController.setBlockAds(e),type:"set-block-ads"}}async setDeviceScreenData(e){return{...await this.appController.setDeviceScreenData(e),type:"set-device-screen"}}async getRateUsData(){return{...await this.appController.getRateUsData(),type:"get-rate-us"}}async incrementRateUsData(){return{...await this.appController.incrementRateUsData(),type:"increment-rate-us"}}async showExtensionStore(){return{...await this.appController.showExtensionStore(),type:"show-extension-store"}}async getBlockWebrtc(){return{...await this.appController.getBlockWebrtc(),type:"get-block-webrtc"}}async enableBlockWebrtc(){return{...await this.appController.enableBlockWebrtc(),type:"enable-block-webrtc"}}async disableBlockWebrtc(){return{...await this.appController.disableBlockWebrtc(),type:"disable-block-webrtc"}}async getActiveTabInfo(){return{...await this.appController.getActiveTabInfo(),type:"get-active-tab-info"}}async getExclusionSites(){return{...await this.appController.getExclusionSites(),type:"get-exclusion-sites"}}async addExclusionSite(e){return{...await this.appController.addExclusionSite(e),type:"add-exclusion-site"}}async removeExclusionSite(e){return{...await this.appController.removeExclusionSite(e),type:"remove-exclusion-site"}}async closeConnectionSurvey(){return{...await this.appController.closeConnectionSurvey(),type:"close-connection-survey"}}async incrementConnectionSurvey(){return{...await this.appController.incrementConnectionSurvey(),type:"increment-connection-survey"}}async delayConnectionSurvey(){return{...await this.appController.delayConnectionSurvey(),type:"delay-connection-survey"}}async disableConnectionSurvey(){return{...await this.appController.disableConnectionSurvey(),type:"disable-connection-survey"}}async getConnectionSurvey(){return{...await this.appController.getConnectionSurvey(),type:"get-connection-survey"}}async getDiscountBanner(){return{...await this.appController.getDiscountBanner(),type:"get-discount-banner-state"}}async getBanner2Session(){return{...await this.appController.getBanner2Session(),type:"get-banner-2-session"}}async disableBanner2Session(){return{...await this.appController.disableBanner2Session(),type:"disable-banner-2-session"}}async getBanner3Connection(){return{...await this.appController.getBanner3Connection(),type:"get-banner-3-connection"}}async disableBanner3Connection(){return{...await this.appController.disableBanner3Connection(),type:"disable-banner-3-connection"}}async getBanner15Connection(){return{...await this.appController.getBanner15Connection(),type:"get-banner-15-connection"}}async disableBanner15Connection(){return{...await this.appController.disableBanner15Connection(),type:"disable-banner-15-connection"}}async getBanner14Days(){return{...await this.appController.getBanner14Days(),type:"get-banner-14-days"}}async disableBanner14Days(){return{...await this.appController.disableBanner14Days(),type:"disable-banner-14-days"}}async getBanner16Days(){return{...await this.appController.getBanner16Days(),type:"get-banner-16-days"}}async disableBanner16Days(){return{...await this.appController.disableBanner16Days(),type:"disable-banner-16-days"}}}const Ur=new Fr(ie,gt,Me,ve,Ie,se,En,An,fe,Cn,Rn,Ke,mt,Vt,Pe),$r=new Lr(Ve,Ur);function jr(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"}class zr extends xn{constructor(){super();A(this,"messageMap",new Map);A(this,"edpPort",null);B.runtime.onConnectExternal.addListener(this.longLivedMessageHandler.bind(this))}async boot(){this.bootResolve(),await this.bootPromise}longLivedMessageHandler(s){this.edpPort=s,s.onMessage.addListener(n=>{if(jr(n)){const r=this.messageMap.get(n.type);r&&this.bootPromise.then(()=>r(n.data)).then(i=>{s.postMessage({id:n.id,...i})}).catch(()=>{})}}),s.onDisconnect.addListener(()=>{this.edpPort=null})}subscribe(s){Object.entries(s).forEach(([r,i])=>{if(this.messageMap.has(r))throw Error(`MessageService: subscribe already has ${r} handler`);this.messageMap.set(r,i)})}notifyEdp(s){var n;(n=this.edpPort)==null||n.postMessage(s)}}const wt=new zr,Hr=R.object({sessionId:R.string().optional().describe(ue.session)}).default({}),qr=new Kt(Hr),Gr="https://www.google-analytics.com/mp/collect",Wr="G-JY9WLXGNHW",Vr="cECyLU2hSiaL1TVJULha8Q",Xe=Yt(navigator.userAgent);class Kr extends Xt{constructor(s,n,r,i,a,o,c,u,l,d,f){super(s);A(this,"GA_URL");this.analyticsStorage=n,this.analyticsService=r,this.globalStateService=i,this.fetchService=a,this.userService=o,this.appService=c,this.notificationService=u,this.i18nService=l,this.connectionService=d,this.edpMessageService=f;const h=new URL(Gr);h.searchParams.set("measurement_id",Wr),h.searchParams.set("api_secret",Vr),this.GA_URL=h.href,this.analyticsService.use(this)}async boot(){await this.analyticsStorage.sync(),this.analyticsStorage.state.sessionId||await this.updateSessionId(),this.bootResolve()}async send(s){if(await this.bootPromise,!this.available)return;const n=this.formatData(s);this.edpMessageService.notifyEdp({type:"edp-ga-analytic-event",success:!0,data:n}),await this.fetchService.request({url:this.GA_URL,method:"POST",body:n})}formatData(s){const n=this.globalStateService.udid.value,r=this.getUserProperties(),i={name:s.name,params:{session_id:this.analyticsStorage.state.sessionId??"",screen_name:"main",engagement_time_msec:100,...s.data??{}}};return{client_id:n,user_properties:r,events:[i]}}getUserProperties(){var u,l;const s=B.runtime.getManifest(),n=this.globalStateService.udid.value,r=((u=this.appService.geolocation)==null?void 0:u.country)??"n/a",i=((l=this.userService.subscription)==null?void 0:l.name)??"free",a=this.notificationService.permition==="allowed"?"on":"off",o=()=>this.appService.colorTheme==="dark"?"on":this.appService.colorTheme==="light"?"off":"default";return{user_type:{value:this.userService.userType},plan:{value:i},udid:{value:n},version:{value:s.version},platform:{value:"chrome_extension"},user_country:{value:r},desktop_notifications:{value:a},dark_mode:{value:o()},language:{value:this.i18nService.activeLocale},auto_connect:{value:this.connectionService.useAutoConnect},browser:{value:Xe.browser.name??"n/a"},browser_version:{value:Xe.browser.version??"n/a"},os:{value:Xe.os.name??"n/a"},os_version:{value:Xe.os.version??"n/a"}}}async updateSessionId(){await this.analyticsStorage.setItems({sessionId:crypto.randomUUID()})}}const Yr=new Qt("google-analytics",qr,mt),ne=new Kr("google-analytics",Yr,ie,se,yt,fe,Me,ve,Ie,Pe,wt),Xr="https://cloudflare.com/cdn-cgi/trace",Qr=R.object({id:R.string(),startedAt:R.number()}),Zr=R.object({startAppVersion:R.string().describe(ue.persist),initialIpAddress:R.string().optional().describe(ue.persist),sessionSequenceNumber:R.number().describe(ue.persist),sessionData:Qr.optional().describe(ue.session),eventSequenceNumber:R.number().describe(ue.persist)}).default({startAppVersion:B.runtime.getManifest().version,sessionSequenceNumber:0,eventSequenceNumber:0}),Jr=new Kt(Zr),ei="us-west-2",ti="29ac8a89-ab3a-4e4a-97c7-d594058fede6",si="veepn-extension-kinesis",ni="AKIA5GXTSFOM3ZRUXRNC",ri="i8yxWsN0zHuGOJdiXLmqwZqytlh3LEFp+6AWLIxv",ii=t=>({setHttpHandler(e){t.httpHandler=e},httpHandler(){return t.httpHandler},updateHttpClientConfig(e,s){var n;(n=t.httpHandler)==null||n.updateHttpClientConfig(e,s)},httpHandlerConfigs(){return t.httpHandler.httpHandlerConfigs()}}),ai=t=>({httpHandler:t.httpHandler()});var xs;(function(t){t.HEADER="header",t.QUERY="query"})(xs||(xs={}));var Es;(function(t){t.HEADER="header",t.QUERY="query"})(Es||(Es={}));var He;(function(t){t.HTTP="http",t.HTTPS="https"})(He||(He={}));var it;(function(t){t.MD5="md5",t.CRC32="crc32",t.CRC32C="crc32c",t.SHA1="sha1",t.SHA256="sha256"})(it||(it={}));var As;(function(t){t[t.HEADER=0]="HEADER",t[t.TRAILER=1]="TRAILER"})(As||(As={}));const $t="__smithy_context";var Cs;(function(t){t.PROFILE="profile",t.SSO_SESSION="sso-session",t.SERVICES="services"})(Cs||(Cs={}));var Rs;(function(t){t.HTTP_0_9="http/0.9",t.HTTP_1_0="http/1.0",t.TDS_8_0="tds/8.0"})(Rs||(Rs={}));class K{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const s=new K({...e,headers:{...e.headers}});return s.query&&(s.query=oi(s.query)),s}static isInstance(e){if(!e)return!1;const s=e;return"method"in s&&"protocol"in s&&"hostname"in s&&"path"in s&&typeof s.query=="object"&&typeof s.headers=="object"}clone(){return K.clone(this)}}function oi(t){return Object.keys(t).reduce((e,s)=>{const n=t[s];return{...e,[s]:Array.isArray(n)?[...n]:n}},{})}class at{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const s=e;return typeof s.statusCode=="number"&&typeof s.headers=="object"}}const ci=t=>e=>async s=>{if(!K.isInstance(s.request))return e(s);const{request:n}=s,{handlerProtocol:r=""}=t.requestHandler.metadata||{};if(r.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let i=n.hostname;n.port!=null&&(i+=`:${n.port}`),n.headers.host=i}return e(s)},ui={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},li=t=>({applyToStack:e=>{e.add(ci(t),ui)}}),di=()=>(t,e)=>async s=>{var n,r;try{const i=await t(s),{clientName:a,commandName:o,logger:c,dynamoDbDocumentClientOptions:u={}}=e,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:d}=u,f=l??e.inputFilterSensitiveLog,h=d??e.outputFilterSensitiveLog,{$metadata:g,...w}=i.output;return(n=c==null?void 0:c.info)==null||n.call(c,{clientName:a,commandName:o,input:f(s.input),output:h(w),metadata:g}),i}catch(i){const{clientName:a,commandName:o,logger:c,dynamoDbDocumentClientOptions:u={}}=e,{overrideInputFilterSensitiveLog:l}=u,d=l??e.inputFilterSensitiveLog;throw(r=c==null?void 0:c.error)==null||r.call(c,{clientName:a,commandName:o,input:d(s.input),error:i,metadata:i.$metadata}),i}},hi={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},fi=t=>({applyToStack:e=>{e.add(di(),hi)}});var _s={};const xt="X-Amzn-Trace-Id",pi="AWS_LAMBDA_FUNCTION_NAME",gi="_X_AMZN_TRACE_ID",mi=t=>e=>async s=>{const{request:n}=s;if(!K.isInstance(n)||t.runtime!=="node")return e(s);const r=Object.keys(n.headers??{}).find(c=>c.toLowerCase()===xt.toLowerCase())??xt;if(n.headers.hasOwnProperty(r))return e(s);const i=_s[pi],a=_s[gi],o=c=>typeof c=="string"&&c.length>0;return o(i)&&o(a)&&(n.headers[xt]=a),e({...s,request:n})},yi={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},wi=t=>({applyToStack:e=>{e.add(mi(t),yi)}}),bt=t=>t[$t]||(t[$t]={}),le=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e};function bi(t){const e=new Map;for(const s of t)e.set(s.schemeId,s);return e}const Si=(t,e)=>(s,n)=>async r=>{var u;const i=t.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(t,n,r.input)),a=bi(t.httpAuthSchemes),o=bt(n),c=[];for(const l of i){const d=a.get(l.schemeId);if(!d){c.push(`HttpAuthScheme \`${l.schemeId}\` was not enabled for this service.`);continue}const f=d.identityProvider(await e.identityProviderConfigProvider(t));if(!f){c.push(`HttpAuthScheme \`${l.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:h={},signingProperties:g={}}=((u=l.propertiesExtractor)==null?void 0:u.call(l,t,n))||{};l.identityProperties=Object.assign(l.identityProperties||{},h),l.signingProperties=Object.assign(l.signingProperties||{},g),o.selectedHttpAuthScheme={httpAuthOption:l,identity:await f(l.identityProperties),signer:d.signer};break}if(!o.selectedHttpAuthScheme)throw new Error(c.join(`
`));return s(r)},vi={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},xi=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:s})=>({applyToStack:n=>{n.addRelativeTo(Si(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:s}),vi)}}),Ei=(t,e)=>(s,n)=>async r=>{var a,o,c,u;const{response:i}=await s(r);try{const l=await e(i,t);return{response:i,output:l}}catch(l){if(Object.defineProperty(l,"$response",{value:i}),!("$metadata"in l)){const d="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{l.message+=`
  `+d}catch{!n.logger||((o=(a=n.logger)==null?void 0:a.constructor)==null?void 0:o.name)==="NoOpLogger"?console.warn(d):(u=(c=n.logger)==null?void 0:c.warn)==null||u.call(c,d)}typeof l.$responseBodyText<"u"&&l.$response&&(l.$response.body=l.$responseBodyText)}throw l}},Ai=(t,e)=>(s,n)=>async r=>{var o;const i=(o=n.endpointV2)!=null&&o.url&&t.urlParser?async()=>t.urlParser(n.endpointV2.url):t.endpoint;if(!i)throw new Error("No valid endpoint provider available.");const a=await e(r.input,{...t,endpoint:i});return s({...r,request:a})},Ci={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},Jt={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function Ri(t,e,s){return{applyToStack:n=>{n.add(Ei(t,s),Ci),n.add(Ai(t,e),Jt)}}}Jt.name;const _i=t=>e=>{throw e},Di=(t,e)=>{},ki=t=>(e,s)=>async n=>{if(!K.isInstance(n.request))return e(n);const i=bt(s).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:a={}},identity:o,signer:c}=i,u=await e({...n,request:await c.sign(n.request,o,a)}).catch((c.errorHandler||_i)(a));return(c.successHandler||Di)(u.response,a),u},Ti={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},Mi=t=>({applyToStack:e=>{e.addRelativeTo(ki(),Ti)}}),Fe=t=>{if(typeof t=="function")return t;const e=Promise.resolve(t);return()=>e},de={},Be=new Array(64);for(let t=0,e=65,s=90;t+e<=s;t++){const n=String.fromCharCode(t+e);de[n]=t,Be[t]=n}for(let t=0,e=97,s=122;t+e<=s;t++){const n=String.fromCharCode(t+e),r=t+26;de[n]=r,Be[r]=n}for(let t=0;t<10;t++){de[t.toString(10)]=t+52;const e=t.toString(10),s=t+52;de[e]=s,Be[s]=e}de["+"]=62;Be[62]="+";de["/"]=63;Be[63]="/";const _e=6,Le=8,Ii=63,es=t=>{let e=t.length/4*3;t.slice(-2)==="=="?e-=2:t.slice(-1)==="="&&e--;const s=new ArrayBuffer(e),n=new DataView(s);for(let r=0;r<t.length;r+=4){let i=0,a=0;for(let u=r,l=r+3;u<=l;u++)if(t[u]!=="="){if(!(t[u]in de))throw new TypeError(`Invalid character ${t[u]} in base64 string.`);i|=de[t[u]]<<(l-u)*_e,a+=_e}else i>>=_e;const o=r/4*3;i>>=a%Le;const c=Math.floor(a/Le);for(let u=0;u<c;u++){const l=(c-u-1)*Le;n.setUint8(o+u,(i&255<<l)>>l)}}return new Uint8Array(s)},De=t=>new TextEncoder().encode(t),Ue=t=>typeof t=="string"?De(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t),Dn=t=>{if(typeof t=="string")return t;if(typeof t!="object"||typeof t.byteOffset!="number"||typeof t.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(t)};function kn(t){let e;typeof t=="string"?e=De(t):e=t;const s=typeof e=="object"&&typeof e.length=="number",n=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!s&&!n)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let r="";for(let i=0;i<e.length;i+=3){let a=0,o=0;for(let u=i,l=Math.min(i+3,e.length);u<l;u++)a|=e[u]<<(l-u-1)*Le,o+=Le;const c=Math.ceil(o/_e);a<<=c*_e-o;for(let u=1;u<=c;u++){const l=(c-u)*_e;r+=Be[(a&Ii<<l)>>l]}r+="==".slice(0,4-c)}return r}function Pi(t,e="utf-8"){return e==="base64"?kn(t):Dn(t)}function Bi(t,e){return e==="base64"?we.mutate(es(t)):we.mutate(De(t))}class we extends Uint8Array{static fromString(e,s="utf-8"){switch(typeof e){case"string":return Bi(e,s);default:throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}}static mutate(e){return Object.setPrototypeOf(e,we.prototype),e}transformToString(e="utf-8"){return Pi(this,e)}}const be=t=>encodeURIComponent(t).replace(/[!'()*]/g,Oi),Oi=t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`;function Ni(t){const e=[];for(let s of Object.keys(t).sort()){const n=t[s];if(s=be(s),Array.isArray(n))for(let r=0,i=n.length;r<i;r++)e.push(`${s}=${be(n[r])}`);else{let r=s;(n||typeof n=="string")&&(r+=`=${be(n)}`),e.push(r)}}return e.join("&")}function Ds(t,e){return new Request(t,e)}function Fi(t=0){return new Promise((e,s)=>{t&&setTimeout(()=>{const n=new Error(`Request did not complete within ${t} ms`);n.name="TimeoutError",s(n)},t)})}const Et={supported:void 0};class ts{static create(e){return typeof(e==null?void 0:e.handle)=="function"?e:new ts(e)}constructor(e){typeof e=="function"?this.configProvider=e().then(s=>s||{}):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),Et.supported===void 0&&(Et.supported=typeof Request<"u"&&"keepalive"in Ds("https://[::1]"))}destroy(){}async handle(e,{abortSignal:s}={}){var S;this.config||(this.config=await this.configProvider);const n=this.config.requestTimeout,r=this.config.keepAlive===!0,i=this.config.credentials;if(s!=null&&s.aborted){const y=new Error("Request aborted");return y.name="AbortError",Promise.reject(y)}let a=e.path;const o=Ni(e.query||{});o&&(a+=`?${o}`),e.fragment&&(a+=`#${e.fragment}`);let c="";if(e.username!=null||e.password!=null){const y=e.username??"",k=e.password??"";c=`${y}:${k}@`}const{port:u,method:l}=e,d=`${e.protocol}//${c}${e.hostname}${u?`:${u}`:""}${a}`,f=l==="GET"||l==="HEAD"?void 0:e.body,h={body:f,headers:new Headers(e.headers),method:l,credentials:i};(S=this.config)!=null&&S.cache&&(h.cache=this.config.cache),f&&(h.duplex="half"),typeof AbortController<"u"&&(h.signal=s),Et.supported&&(h.keepalive=r),typeof this.config.requestInit=="function"&&Object.assign(h,this.config.requestInit(e));let g=()=>{};const w=Ds(d,h),m=[fetch(w).then(y=>{const k=y.headers,C={};for(const G of k.entries())C[G[0]]=G[1];return y.body!=null?{response:new at({headers:C,reason:y.statusText,statusCode:y.status,body:y.body})}:y.blob().then(G=>({response:new at({headers:C,reason:y.statusText,statusCode:y.status,body:G})}))}),Fi(n)];return s&&m.push(new Promise((y,k)=>{const C=()=>{const O=new Error("Request aborted");O.name="AbortError",k(O)};if(typeof s.addEventListener=="function"){const O=s;O.addEventListener("abort",C,{once:!0}),g=()=>O.removeEventListener("abort",C)}else s.onabort=C})),Promise.race(m).finally(g)}updateHttpClientConfig(e,s){this.config=void 0,this.configProvider=this.configProvider.then(n=>(n[e]=s,n))}httpHandlerConfigs(){return this.config??{}}}const Li=async t=>{var e;return typeof Blob=="function"&&t instanceof Blob||((e=t.constructor)==null?void 0:e.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await t.arrayBuffer()):Ui(t):$i(t)};async function Ui(t){const e=await ji(t),s=es(e);return new Uint8Array(s)}async function $i(t){const e=[],s=t.getReader();let n=!1,r=0;for(;!n;){const{done:o,value:c}=await s.read();c&&(e.push(c),r+=c.length),n=o}const i=new Uint8Array(r);let a=0;for(const o of e)i.set(o,a),a+=o.length;return i}function ji(t){return new Promise((e,s)=>{const n=new FileReader;n.onloadend=()=>{if(n.readyState!==2)return s(new Error("Reader aborted too early"));const r=n.result??"",i=r.indexOf(","),a=i>-1?i+1:r.length;e(r.substring(a))},n.onabort=()=>s(new Error("Read aborted")),n.onerror=()=>s(n.error),n.readAsDataURL(t)})}const Tn={},jt={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Tn[t]=e,jt[e]=t}function Mn(t){if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let s=0;s<t.length;s+=2){const n=t.slice(s,s+2).toLowerCase();if(n in jt)e[s/2]=jt[n];else throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`)}return e}function V(t){let e="";for(let s=0;s<t.byteLength;s++)e+=Tn[t[s]];return e}const zi=async(t=new Uint8Array,e)=>{if(t instanceof Uint8Array)return we.mutate(t);if(!t)return we.mutate(new Uint8Array);const s=e.streamCollector(t);return we.mutate(await s)};function Hi(t,e,s){t.__smithy_context?t.__smithy_context.features||(t.__smithy_context.features={}):t.__smithy_context={features:{}},t.__smithy_context.features[e]=s}class qi{constructor(e){this.authSchemes=new Map;for(const[s,n]of Object.entries(e))n!==void 0&&this.authSchemes.set(s,n)}getIdentityProvider(e){return this.authSchemes.get(e)}}const Gi=t=>e=>In(e)&&e.expiration.getTime()-Date.now()<t,Wi=3e5,Vi=Gi(Wi),In=t=>t.expiration!==void 0,Ki=(t,e,s)=>{if(t===void 0)return;const n=typeof t!="function"?async()=>Promise.resolve(t):t;let r,i,a,o=!1;const c=async u=>{i||(i=n(u));try{r=await i,a=!0,o=!1}finally{i=void 0}return r};return e===void 0?async u=>((!a||u!=null&&u.forceRefresh)&&(r=await c(u)),r):async u=>((!a||u!=null&&u.forceRefresh)&&(r=await c(u)),o?r:s(r)?(e(r)&&await c(u),r):(o=!0,r))},Yi=void 0;function Xi(t){return t===void 0?!0:typeof t=="string"&&t.length<=50}function Qi(t){const e=Fe(t.userAgentAppId??Yi),{customUserAgent:s}=t;return Object.assign(t,{customUserAgent:typeof s=="string"?[[s]]:s,userAgentAppId:async()=>{var r,i;const n=await e();if(!Xi(n)){const a=((i=(r=t.logger)==null?void 0:r.constructor)==null?void 0:i.name)==="NoOpLogger"||!t.logger?console:t.logger;typeof n!="string"?a==null||a.warn("userAgentAppId must be a string or undefined."):n.length>50&&(a==null||a.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return n}})}class Zi{constructor({size:e,params:s}){this.data=new Map,this.parameters=[],this.capacity=e??50,s&&(this.parameters=s)}get(e,s){const n=this.hash(e);if(n===!1)return s();if(!this.data.has(n)){if(this.data.size>this.capacity+10){const r=this.data.keys();let i=0;for(;;){const{value:a,done:o}=r.next();if(this.data.delete(a),o||++i>10)break}}this.data.set(n,s())}return this.data.get(n)}size(){return this.data.size}hash(e){let s="";const{parameters:n}=this;if(n.length===0)return!1;for(const r of n){const i=String(e[r]??"");if(i.includes("|;"))return!1;s+=i+"|;"}return s}}const Ji=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Pn=t=>Ji.test(t)||t.startsWith("[")&&t.endsWith("]"),ea=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),ss=(t,e=!1)=>{if(!e)return ea.test(t);const s=t.split(".");for(const n of s)if(!ss(n))return!1;return!0},ot={},qe="endpoints";function he(t){return typeof t!="object"||t==null?t:"ref"in t?`$${he(t.ref)}`:"fn"in t?`${t.fn}(${(t.argv||[]).map(he).join(", ")})`:JSON.stringify(t,null,2)}class Y extends Error{constructor(e){super(e),this.name="EndpointError"}}const ta=(t,e)=>t===e,sa=t=>{const e=t.split("."),s=[];for(const n of e){const r=n.indexOf("[");if(r!==-1){if(n.indexOf("]")!==n.length-1)throw new Y(`Path: '${t}' does not end with ']'`);const i=n.slice(r+1,-1);if(Number.isNaN(parseInt(i)))throw new Y(`Invalid array index: '${i}' in path: '${t}'`);r!==0&&s.push(n.slice(0,r)),s.push(i)}else s.push(n)}return s},Bn=(t,e)=>sa(e).reduce((s,n)=>{if(typeof s!="object")throw new Y(`Index '${n}' in '${e}' not found in '${JSON.stringify(t)}'`);return Array.isArray(s)?s[parseInt(n)]:s[n]},t),na=t=>t!=null,ra=t=>!t,At={[He.HTTP]:80,[He.HTTPS]:443},ia=t=>{const e=(()=>{try{if(t instanceof URL)return t;if(typeof t=="object"&&"hostname"in t){const{hostname:f,port:h,protocol:g="",path:w="",query:m={}}=t,S=new URL(`${g}//${f}${h?`:${h}`:""}${w}`);return S.search=Object.entries(m).map(([y,k])=>`${y}=${k}`).join("&"),S}return new URL(t)}catch{return null}})();if(!e)return console.error(`Unable to parse ${JSON.stringify(t)} as a whatwg URL.`),null;const s=e.href,{host:n,hostname:r,pathname:i,protocol:a,search:o}=e;if(o)return null;const c=a.slice(0,-1);if(!Object.values(He).includes(c))return null;const u=Pn(r),l=s.includes(`${n}:${At[c]}`)||typeof t=="string"&&t.includes(`${n}:${At[c]}`),d=`${n}${l?`:${At[c]}`:""}`;return{scheme:c,authority:d,path:i,normalizedPath:i.endsWith("/")?i:`${i}/`,isIp:u}},aa=(t,e)=>t===e,oa=(t,e,s,n)=>e>=s||t.length<s?null:n?t.substring(t.length-s,t.length-e):t.substring(e,s),ca=t=>encodeURIComponent(t).replace(/[!*'()]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),ua={booleanEquals:ta,getAttr:Bn,isSet:na,isValidHostLabel:ss,not:ra,parseURL:ia,stringEquals:aa,substring:oa,uriEncode:ca},On=(t,e)=>{const s=[],n={...e.endpointParams,...e.referenceRecord};let r=0;for(;r<t.length;){const i=t.indexOf("{",r);if(i===-1){s.push(t.slice(r));break}s.push(t.slice(r,i));const a=t.indexOf("}",i);if(a===-1){s.push(t.slice(i));break}t[i+1]==="{"&&t[a+1]==="}"&&(s.push(t.slice(i+1,a)),r=a+2);const o=t.substring(i+1,a);if(o.includes("#")){const[c,u]=o.split("#");s.push(Bn(n[c],u))}else s.push(n[o]);r=a+1}return s.join("")},la=({ref:t},e)=>({...e.endpointParams,...e.referenceRecord})[t],St=(t,e,s)=>{if(typeof t=="string")return On(t,s);if(t.fn)return Nn(t,s);if(t.ref)return la(t,s);throw new Y(`'${e}': ${String(t)} is not a string, function or reference.`)},Nn=({fn:t,argv:e},s)=>{const n=e.map(i=>["boolean","number"].includes(typeof i)?i:St(i,"arg",s)),r=t.split(".");return r[0]in ot&&r[1]!=null?ot[r[0]][r[1]](...n):ua[t](...n)},da=({assign:t,...e},s)=>{var r,i;if(t&&t in s.referenceRecord)throw new Y(`'${t}' is already defined in Reference Record.`);const n=Nn(e,s);return(i=(r=s.logger)==null?void 0:r.debug)==null||i.call(r,`${qe} evaluateCondition: ${he(e)} = ${he(n)}`),{result:n===""?!0:!!n,...t!=null&&{toAssign:{name:t,value:n}}}},ns=(t=[],e)=>{var n,r;const s={};for(const i of t){const{result:a,toAssign:o}=da(i,{...e,referenceRecord:{...e.referenceRecord,...s}});if(!a)return{result:a};o&&(s[o.name]=o.value,(r=(n=e.logger)==null?void 0:n.debug)==null||r.call(n,`${qe} assign: ${o.name} := ${he(o.value)}`))}return{result:!0,referenceRecord:s}},ha=(t,e)=>Object.entries(t).reduce((s,[n,r])=>({...s,[n]:r.map(i=>{const a=St(i,"Header value entry",e);if(typeof a!="string")throw new Y(`Header '${n}' value '${a}' is not a string`);return a})}),{}),Fn=(t,e)=>{if(Array.isArray(t))return t.map(s=>Fn(s,e));switch(typeof t){case"string":return On(t,e);case"object":if(t===null)throw new Y(`Unexpected endpoint property: ${t}`);return Ln(t,e);case"boolean":return t;default:throw new Y(`Unexpected endpoint property type: ${typeof t}`)}},Ln=(t,e)=>Object.entries(t).reduce((s,[n,r])=>({...s,[n]:Fn(r,e)}),{}),fa=(t,e)=>{const s=St(t,"Endpoint URL",e);if(typeof s=="string")try{return new URL(s)}catch(n){throw console.error(`Failed to construct URL with ${s}`,n),n}throw new Y(`Endpoint URL must be a string, got ${typeof s}`)},pa=(t,e)=>{var l,d;const{conditions:s,endpoint:n}=t,{result:r,referenceRecord:i}=ns(s,e);if(!r)return;const a={...e,referenceRecord:{...e.referenceRecord,...i}},{url:o,properties:c,headers:u}=n;return(d=(l=e.logger)==null?void 0:l.debug)==null||d.call(l,`${qe} Resolving endpoint from template: ${he(n)}`),{...u!=null&&{headers:ha(u,a)},...c!=null&&{properties:Ln(c,a)},url:fa(o,a)}},ga=(t,e)=>{const{conditions:s,error:n}=t,{result:r,referenceRecord:i}=ns(s,e);if(r)throw new Y(St(n,"Error",{...e,referenceRecord:{...e.referenceRecord,...i}}))},ma=(t,e)=>{const{conditions:s,rules:n}=t,{result:r,referenceRecord:i}=ns(s,e);if(r)return Un(n,{...e,referenceRecord:{...e.referenceRecord,...i}})},Un=(t,e)=>{for(const s of t)if(s.type==="endpoint"){const n=pa(s,e);if(n)return n}else if(s.type==="error")ga(s,e);else if(s.type==="tree"){const n=ma(s,e);if(n)return n}else throw new Y(`Unknown endpoint rule: ${s}`);throw new Y("Rules evaluation failed")},ya=(t,e)=>{var u,l,d,f;const{endpointParams:s,logger:n}=e,{parameters:r,rules:i}=t;(l=(u=e.logger)==null?void 0:u.debug)==null||l.call(u,`${qe} Initial EndpointParams: ${he(s)}`);const a=Object.entries(r).filter(([,h])=>h.default!=null).map(([h,g])=>[h,g.default]);if(a.length>0)for(const[h,g]of a)s[h]=s[h]??g;const o=Object.entries(r).filter(([,h])=>h.required).map(([h])=>h);for(const h of o)if(s[h]==null)throw new Y(`Missing required parameter: '${h}'`);const c=Un(i,{endpointParams:s,logger:n,referenceRecord:{}});return(f=(d=e.logger)==null?void 0:d.debug)==null||f.call(d,`${qe} Resolved endpoint: ${he(c)}`),c},$n=(t,e=!1)=>{if(e){for(const s of t.split("."))if(!$n(s))return!1;return!0}return!(!ss(t)||t.length<3||t.length>63||t!==t.toLowerCase()||Pn(t))},ks=":",wa="/",ba=t=>{const e=t.split(ks);if(e.length<6)return null;const[s,n,r,i,a,...o]=e;if(s!=="arn"||n===""||r===""||o.join(ks)==="")return null;const c=o.map(u=>u.split(wa)).flat();return{partition:n,service:r,region:i,accountId:a,resourceId:c}},Sa=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"AWS ISOF global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"amazonaws.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}}],va={partitions:Sa};let xa=va;const Ea=t=>{const{partitions:e}=xa;for(const n of e){const{regions:r,outputs:i}=n;for(const[a,o]of Object.entries(r))if(a===t)return{...i,...o}}for(const n of e){const{regionRegex:r,outputs:i}=n;if(new RegExp(r).test(t))return{...i}}const s=e.find(n=>n.id==="aws");if(!s)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...s.outputs}},jn={isVirtualHostableS3Bucket:$n,parseArn:ba,partition:Ea};ot.aws=jn;function Aa(t,e,s){return t.$source||(t.$source={}),t.$source[e]=s,t}function Z(t,e,s){t.__aws_sdk_context?t.__aws_sdk_context.features||(t.__aws_sdk_context.features={}):t.__aws_sdk_context={features:{}},t.__aws_sdk_context.features[e]=s}const Ts=t=>{var e,s;return at.isInstance(t)?((e=t.headers)==null?void 0:e.date)??((s=t.headers)==null?void 0:s.Date):void 0},zn=t=>new Date(Date.now()+t),Ca=(t,e)=>Math.abs(zn(e).getTime()-t)>=3e5,Ms=(t,e)=>{const s=Date.parse(t);return Ca(s,e)?s-Date.now():e},$e=(t,e)=>{if(!e)throw new Error(`Property \`${t}\` is not resolved for AWS SDK SigV4Auth`);return e},Ra=async t=>{var u,l,d;const e=$e("context",t.context),s=$e("config",t.config),n=(d=(l=(u=e.endpointV2)==null?void 0:u.properties)==null?void 0:l.authSchemes)==null?void 0:d[0],i=await $e("signer",s.signer)(n),a=t==null?void 0:t.signingRegion,o=t==null?void 0:t.signingRegionSet,c=t==null?void 0:t.signingName;return{config:s,signer:i,signingRegion:a,signingRegionSet:o,signingName:c}};class _a{async sign(e,s,n){var d;if(!K.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const r=await Ra(n),{config:i,signer:a}=r;let{signingRegion:o,signingName:c}=r;const u=n.context;if(((d=u==null?void 0:u.authSchemes)==null?void 0:d.length)??!1){const[f,h]=u.authSchemes;(f==null?void 0:f.name)==="sigv4a"&&(h==null?void 0:h.name)==="sigv4"&&(o=(h==null?void 0:h.signingRegion)??o,c=(h==null?void 0:h.signingName)??c)}return await a.sign(e,{signingDate:zn(i.systemClockOffset),signingRegion:o,signingService:c})}errorHandler(e){return s=>{const n=s.ServerTime??Ts(s.$response);if(n){const r=$e("config",e.config),i=r.systemClockOffset;r.systemClockOffset=Ms(n,r.systemClockOffset),r.systemClockOffset!==i&&s.$metadata&&(s.$metadata.clockSkewCorrected=!0)}throw s}}successHandler(e,s){const n=Ts(e);if(n){const r=$e("config",s.config);r.systemClockOffset=Ms(n,r.systemClockOffset)}}}const Da=(t,e,s)=>{let n,r,i,a=!1;const o=async()=>{r||(r=t());try{n=await r,i=!0,a=!1}finally{r=void 0}return n};return async c=>((!i||c!=null&&c.forceRefresh)&&(n=await o()),n)},ka="X-Amz-Algorithm",Ta="X-Amz-Credential",Hn="X-Amz-Date",Ma="X-Amz-SignedHeaders",Ia="X-Amz-Expires",qn="X-Amz-Signature",Gn="X-Amz-Security-Token",Wn="authorization",Vn=Hn.toLowerCase(),Pa="date",Ba=[Wn,Vn,Pa],Oa=qn.toLowerCase(),zt="x-amz-content-sha256",Na=Gn.toLowerCase(),Fa={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},La=/^proxy-/,Ua=/^sec-/,Ct="AWS4-HMAC-SHA256",$a="AWS4-HMAC-SHA256-PAYLOAD",ja="UNSIGNED-PAYLOAD",za=50,Kn="aws4_request",Ha=60*60*24*7,Qe={},Rt=[],_t=(t,e,s)=>`${t}/${e}/${s}/${Kn}`,qa=async(t,e,s,n,r)=>{const i=await Is(t,e.secretAccessKey,e.accessKeyId),a=`${s}:${n}:${r}:${V(i)}:${e.sessionToken}`;if(a in Qe)return Qe[a];for(Rt.push(a);Rt.length>za;)delete Qe[Rt.shift()];let o=`AWS4${e.secretAccessKey}`;for(const c of[s,n,r,Kn])o=await Is(t,o,c);return Qe[a]=o},Is=(t,e,s)=>{const n=new t(e);return n.update(Ue(s)),n.digest()},Ps=({headers:t},e,s)=>{const n={};for(const r of Object.keys(t).sort()){if(t[r]==null)continue;const i=r.toLowerCase();(i in Fa||e!=null&&e.has(i)||La.test(i)||Ua.test(i))&&(!s||s&&!s.has(i))||(n[i]=t[r].trim().replace(/\s+/g," "))}return n},Ga=({query:t={}})=>{const e=[],s={};for(const n of Object.keys(t)){if(n.toLowerCase()===Oa)continue;const r=be(n);e.push(r);const i=t[n];typeof i=="string"?s[r]=`${r}=${be(i)}`:Array.isArray(i)&&(s[r]=i.slice(0).reduce((a,o)=>a.concat([`${r}=${be(o)}`]),[]).sort().join("&"))}return e.sort().map(n=>s[n]).filter(n=>n).join("&")},Wa=t=>typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||Object.prototype.toString.call(t)==="[object ArrayBuffer]",Dt=async({headers:t,body:e},s)=>{for(const n of Object.keys(t))if(n.toLowerCase()===zt)return t[n];if(e==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof e=="string"||ArrayBuffer.isView(e)||Wa(e)){const n=new s;return n.update(Ue(e)),V(await n.digest())}return ja};class Va{format(e){const s=[];for(const i of Object.keys(e)){const a=De(i);s.push(Uint8Array.from([a.byteLength]),a,this.formatHeaderValue(e[i]))}const n=new Uint8Array(s.reduce((i,a)=>i+a.byteLength,0));let r=0;for(const i of s)n.set(i,r),r+=i.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const s=new DataView(new ArrayBuffer(3));return s.setUint8(0,3),s.setInt16(1,e.value,!1),new Uint8Array(s.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const a=new Uint8Array(i.buffer);return a.set(e.value,3),a;case"string":const o=De(e.value),c=new DataView(new ArrayBuffer(3+o.byteLength));c.setUint8(0,7),c.setUint16(1,o.byteLength,!1);const u=new Uint8Array(c.buffer);return u.set(o,3),u;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(Ya.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!Ka.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(Mn(e.value.replace(/\-/g,"")),1),d}}}var Bs;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(Bs||(Bs={}));const Ka=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let Ya=class Yn{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const s=new Uint8Array(8);for(let n=7,r=Math.abs(Math.round(e));n>-1&&r>0;n--,r/=256)s[n]=r;return e<0&&Os(s),new Yn(s)}valueOf(){const e=this.bytes.slice(0),s=e[0]&128;return s&&Os(e),parseInt(V(e),16)*(s?-1:1)}toString(){return String(this.valueOf())}};function Os(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}const Xa=(t,e)=>{t=t.toLowerCase();for(const s of Object.keys(e))if(t===s.toLowerCase())return!0;return!1},Qa=(t,e={})=>{var r,i;const{headers:s,query:n={}}=K.clone(t);for(const a of Object.keys(s)){const o=a.toLowerCase();(o.slice(0,6)==="x-amz-"&&!((r=e.unhoistableHeaders)!=null&&r.has(o))||(i=e.hoistableHeaders)!=null&&i.has(o))&&(n[a]=s[a],delete s[a])}return{...t,headers:s,query:n}},Ns=t=>{t=K.clone(t);for(const e of Object.keys(t.headers))Ba.indexOf(e.toLowerCase())>-1&&delete t.headers[e];return t},Za=t=>Ja(t).toISOString().replace(/\.\d{3}Z$/,"Z"),Ja=t=>typeof t=="number"?new Date(t*1e3):typeof t=="string"?Number(t)?new Date(Number(t)*1e3):new Date(t):t;class Fs{constructor({applyChecksum:e,credentials:s,region:n,service:r,sha256:i,uriEscapePath:a=!0}){this.headerFormatter=new Va,this.service=r,this.sha256=i,this.uriEscapePath=a,this.applyChecksum=typeof e=="boolean"?e:!0,this.regionProvider=le(n),this.credentialProvider=le(s)}async presign(e,s={}){const{signingDate:n=new Date,expiresIn:r=3600,unsignableHeaders:i,unhoistableHeaders:a,signableHeaders:o,hoistableHeaders:c,signingRegion:u,signingService:l}=s,d=await this.credentialProvider();this.validateResolvedCredentials(d);const f=u??await this.regionProvider(),{longDate:h,shortDate:g}=Ze(n);if(r>Ha)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const w=_t(g,f,l??this.service),m=Qa(Ns(e),{unhoistableHeaders:a,hoistableHeaders:c});d.sessionToken&&(m.query[Gn]=d.sessionToken),m.query[ka]=Ct,m.query[Ta]=`${d.accessKeyId}/${w}`,m.query[Hn]=h,m.query[Ia]=r.toString(10);const S=Ps(m,i,o);return m.query[Ma]=Ls(S),m.query[qn]=await this.getSignature(h,w,this.getSigningKey(d,f,g,l),this.createCanonicalRequest(m,S,await Dt(e,this.sha256))),m}async sign(e,s){return typeof e=="string"?this.signString(e,s):e.headers&&e.payload?this.signEvent(e,s):e.message?this.signMessage(e,s):this.signRequest(e,s)}async signEvent({headers:e,payload:s},{signingDate:n=new Date,priorSignature:r,signingRegion:i,signingService:a}){const o=i??await this.regionProvider(),{shortDate:c,longDate:u}=Ze(n),l=_t(c,o,a??this.service),d=await Dt({headers:{},body:s},this.sha256),f=new this.sha256;f.update(e);const h=V(await f.digest()),g=[$a,u,l,r,h,d].join(`
`);return this.signString(g,{signingDate:n,signingRegion:o,signingService:a})}async signMessage(e,{signingDate:s=new Date,signingRegion:n,signingService:r}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:s,signingRegion:n,signingService:r,priorSignature:e.priorSignature}).then(a=>({message:e.message,signature:a}))}async signString(e,{signingDate:s=new Date,signingRegion:n,signingService:r}={}){const i=await this.credentialProvider();this.validateResolvedCredentials(i);const a=n??await this.regionProvider(),{shortDate:o}=Ze(s),c=new this.sha256(await this.getSigningKey(i,a,o,r));return c.update(Ue(e)),V(await c.digest())}async signRequest(e,{signingDate:s=new Date,signableHeaders:n,unsignableHeaders:r,signingRegion:i,signingService:a}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const c=i??await this.regionProvider(),u=Ns(e),{longDate:l,shortDate:d}=Ze(s),f=_t(d,c,a??this.service);u.headers[Vn]=l,o.sessionToken&&(u.headers[Na]=o.sessionToken);const h=await Dt(u,this.sha256);!Xa(zt,u.headers)&&this.applyChecksum&&(u.headers[zt]=h);const g=Ps(u,r,n),w=await this.getSignature(l,f,this.getSigningKey(o,c,d,a),this.createCanonicalRequest(u,g,h));return u.headers[Wn]=`${Ct} Credential=${o.accessKeyId}/${f}, SignedHeaders=${Ls(g)}, Signature=${w}`,u}createCanonicalRequest(e,s,n){const r=Object.keys(s).sort();return`${e.method}
${this.getCanonicalPath(e)}
${Ga(e)}
${r.map(i=>`${i}:${s[i]}`).join(`
`)}

${r.join(";")}
${n}`}async createStringToSign(e,s,n){const r=new this.sha256;r.update(Ue(n));const i=await r.digest();return`${Ct}
${e}
${s}
${V(i)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const s=[];for(const i of e.split("/"))(i==null?void 0:i.length)!==0&&i!=="."&&(i===".."?s.pop():s.push(i));const n=`${e!=null&&e.startsWith("/")?"/":""}${s.join("/")}${s.length>0&&(e!=null&&e.endsWith("/"))?"/":""}`;return be(n).replace(/%2F/g,"/")}return e}async getSignature(e,s,n,r){const i=await this.createStringToSign(e,s,r),a=new this.sha256(await n);return a.update(Ue(i)),V(await a.digest())}getSigningKey(e,s,n,r){return qa(this.sha256,e,n,s,r||this.service)}validateResolvedCredentials(e){if(typeof e!="object"||typeof e.accessKeyId!="string"||typeof e.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}}const Ze=t=>{const e=Za(t).replace(/[\-:]/g,"");return{longDate:e,shortDate:e.slice(0,8)}},Ls=t=>Object.keys(t).sort().join(";"),eo=t=>{let e=t.credentials,s=!!t.credentials,n;Object.defineProperty(t,"credentials",{set(u){u&&u!==e&&u!==n&&(s=!0),e=u;const l=to(t,{credentials:e,credentialDefaultProvider:t.credentialDefaultProvider}),d=so(t,l);s&&!d.attributed?(n=async f=>d(f).then(h=>Aa(h,"CREDENTIALS_CODE","e")),n.memoized=d.memoized,n.configBound=d.configBound,n.attributed=!0):n=d},get(){return n},enumerable:!0,configurable:!0}),t.credentials=e;const{signingEscapePath:r=!0,systemClockOffset:i=t.systemClockOffset||0,sha256:a}=t;let o;return t.signer?o=Fe(t.signer):t.regionInfoProvider?o=()=>Fe(t.region)().then(async u=>[await t.regionInfoProvider(u,{useFipsEndpoint:await t.useFipsEndpoint(),useDualstackEndpoint:await t.useDualstackEndpoint()})||{},u]).then(([u,l])=>{const{signingRegion:d,signingService:f}=u;t.signingRegion=t.signingRegion||d||l,t.signingName=t.signingName||f||t.serviceId;const h={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:a,uriEscapePath:r},g=t.signerConstructor||Fs;return new g(h)}):o=async u=>{u=Object.assign({},{name:"sigv4",signingName:t.signingName||t.defaultSigningName,signingRegion:await Fe(t.region)(),properties:{}},u);const l=u.signingRegion,d=u.signingName;t.signingRegion=t.signingRegion||l,t.signingName=t.signingName||d||t.serviceId;const f={...t,credentials:t.credentials,region:t.signingRegion,service:t.signingName,sha256:a,uriEscapePath:r},h=t.signerConstructor||Fs;return new h(f)},Object.assign(t,{systemClockOffset:i,signingEscapePath:r,signer:o})};function to(t,{credentials:e,credentialDefaultProvider:s}){let n;return e?e!=null&&e.memoized?n=e:n=Ki(e,Vi,In):s?n=Fe(s(Object.assign({},t,{parentClientConfig:t}))):n=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},n.memoized=!0,n}function so(t,e){if(e.configBound)return e;const s=async n=>e({...n,callerClientConfig:t});return s.memoized=e.memoized,s.configBound=!0,s}const pe=(t,e)=>{const s=[];if(t&&s.push(t),e)for(const n of e)s.push(n);return s},ae=(t,e)=>`${t||"anonymous"}${e&&e.length>0?` (a.k.a. ${e.join(",")})`:""}`,ct=()=>{let t=[],e=[],s=!1;const n=new Set,r=d=>d.sort((f,h)=>Us[h.step]-Us[f.step]||$s[h.priority||"normal"]-$s[f.priority||"normal"]),i=d=>{let f=!1;const h=g=>{const w=pe(g.name,g.aliases);if(w.includes(d)){f=!0;for(const m of w)n.delete(m);return!1}return!0};return t=t.filter(h),e=e.filter(h),f},a=d=>{let f=!1;const h=g=>{if(g.middleware===d){f=!0;for(const w of pe(g.name,g.aliases))n.delete(w);return!1}return!0};return t=t.filter(h),e=e.filter(h),f},o=d=>{var f;return t.forEach(h=>{d.add(h.middleware,{...h})}),e.forEach(h=>{d.addRelativeTo(h.middleware,{...h})}),(f=d.identifyOnResolve)==null||f.call(d,l.identifyOnResolve()),d},c=d=>{const f=[];return d.before.forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f.push(d),d.after.reverse().forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f},u=(d=!1)=>{const f=[],h=[],g={};return t.forEach(m=>{const S={...m,before:[],after:[]};for(const y of pe(S.name,S.aliases))g[y]=S;f.push(S)}),e.forEach(m=>{const S={...m,before:[],after:[]};for(const y of pe(S.name,S.aliases))g[y]=S;h.push(S)}),h.forEach(m=>{if(m.toMiddleware){const S=g[m.toMiddleware];if(S===void 0){if(d)return;throw new Error(`${m.toMiddleware} is not found when adding ${ae(m.name,m.aliases)} middleware ${m.relation} ${m.toMiddleware}`)}m.relation==="after"&&S.after.push(m),m.relation==="before"&&S.before.push(m)}}),r(f).map(c).reduce((m,S)=>(m.push(...S),m),[])},l={add:(d,f={})=>{const{name:h,override:g,aliases:w}=f,m={step:"initialize",priority:"normal",middleware:d,...f},S=pe(h,w);if(S.length>0){if(S.some(y=>n.has(y))){if(!g)throw new Error(`Duplicate middleware name '${ae(h,w)}'`);for(const y of S){const k=t.findIndex(O=>{var G;return O.name===y||((G=O.aliases)==null?void 0:G.some(Ee=>Ee===y))});if(k===-1)continue;const C=t[k];if(C.step!==m.step||m.priority!==C.priority)throw new Error(`"${ae(C.name,C.aliases)}" middleware with ${C.priority} priority in ${C.step} step cannot be overridden by "${ae(h,w)}" middleware with ${m.priority} priority in ${m.step} step.`);t.splice(k,1)}}for(const y of S)n.add(y)}t.push(m)},addRelativeTo:(d,f)=>{const{name:h,override:g,aliases:w}=f,m={middleware:d,...f},S=pe(h,w);if(S.length>0){if(S.some(y=>n.has(y))){if(!g)throw new Error(`Duplicate middleware name '${ae(h,w)}'`);for(const y of S){const k=e.findIndex(O=>{var G;return O.name===y||((G=O.aliases)==null?void 0:G.some(Ee=>Ee===y))});if(k===-1)continue;const C=e[k];if(C.toMiddleware!==m.toMiddleware||C.relation!==m.relation)throw new Error(`"${ae(C.name,C.aliases)}" middleware ${C.relation} "${C.toMiddleware}" middleware cannot be overridden by "${ae(h,w)}" middleware ${m.relation} "${m.toMiddleware}" middleware.`);e.splice(k,1)}}for(const y of S)n.add(y)}e.push(m)},clone:()=>o(ct()),use:d=>{d.applyToStack(l)},remove:d=>typeof d=="string"?i(d):a(d),removeByTag:d=>{let f=!1;const h=g=>{const{tags:w,name:m,aliases:S}=g;if(w&&w.includes(d)){const y=pe(m,S);for(const k of y)n.delete(k);return f=!0,!1}return!0};return t=t.filter(h),e=e.filter(h),f},concat:d=>{var h;const f=o(ct());return f.use(d),f.identifyOnResolve(s||f.identifyOnResolve()||(((h=d.identifyOnResolve)==null?void 0:h.call(d))??!1)),f},applyToStack:o,identify:()=>u(!0).map(d=>{const f=d.step??d.relation+" "+d.toMiddleware;return ae(d.name,d.aliases)+" - "+f}),identifyOnResolve(d){return typeof d=="boolean"&&(s=d),s},resolve:(d,f)=>{for(const h of u().map(g=>g.middleware).reverse())d=h(d,f);return s&&console.log(l.identify()),d}};return l},Us={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},$s={high:3,normal:2,low:1};class no{constructor(e){this.config=e,this.middlewareStack=ct()}send(e,s,n){const r=typeof s!="function"?s:void 0,i=typeof s=="function"?s:n,a=r===void 0&&this.config.cacheMiddleware===!0;let o;if(a){this.handlers||(this.handlers=new WeakMap);const c=this.handlers;c.has(e.constructor)?o=c.get(e.constructor):(o=e.resolveMiddleware(this.middlewareStack,this.config,r),c.set(e.constructor,o))}else delete this.handlers,o=e.resolveMiddleware(this.middlewareStack,this.config,r);if(i)o(e).then(c=>i(null,c.output),c=>i(c)).catch(()=>{});else return o(e).then(c=>c.output)}destroy(){var e,s,n;(n=(s=(e=this.config)==null?void 0:e.requestHandler)==null?void 0:s.destroy)==null||n.call(s),delete this.handlers}}class Xn{constructor(){this.middlewareStack=ct()}static classBuilder(){return new ro}resolveMiddlewareWithContext(e,s,n,{middlewareFn:r,clientName:i,commandName:a,inputFilterSensitiveLog:o,outputFilterSensitiveLog:c,smithyContext:u,additionalContext:l,CommandCtor:d}){for(const m of r.bind(this)(d,e,s,n))this.middlewareStack.use(m);const f=e.concat(this.middlewareStack),{logger:h}=s,g={logger:h,clientName:i,commandName:a,inputFilterSensitiveLog:o,outputFilterSensitiveLog:c,[$t]:{commandInstance:this,...u},...l},{requestHandler:w}=s;return f.resolve(m=>w.handle(m.request,n||{}),g)}}class ro{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,s,n={}){return this._smithyContext={service:e,operation:s,...n},this}c(e={}){return this._additionalContext=e,this}n(e,s){return this._clientName=e,this._commandName=s,this}f(e=n=>n,s=n=>n){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=s,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){const e=this;let s;return s=class extends Xn{static getEndpointParameterInstructions(){return e._ep}constructor(...[n]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=n??{},e._init(this)}resolveMiddleware(n,r,i){return this.resolveMiddlewareWithContext(n,r,i,{CommandCtor:s,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}class Ce extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}static isInstance(e){if(!e)return!1;const s=e;return Ce.prototype.isPrototypeOf(s)||!!s.$fault&&!!s.$metadata&&(s.$fault==="client"||s.$fault==="server")}static[Symbol.hasInstance](e){if(!e)return!1;const s=e;return this===Ce?Ce.isInstance(e):Ce.isInstance(e)?s.name&&this.name?this.prototype.isPrototypeOf(e)||s.name===this.name:this.prototype.isPrototypeOf(e):!1}}const $=(t,e={})=>{Object.entries(e).filter(([,n])=>n!==void 0).forEach(([n,r])=>{(t[n]==null||t[n]==="")&&(t[n]=r)});const s=t.message||t.Message||"UnknownError";return t.message=s,delete t.Message,t},io=({output:t,parsedBody:e,exceptionCtor:s,errorCode:n})=>{const r=oo(t),i=r.httpStatusCode?r.httpStatusCode+"":void 0,a=new s({name:(e==null?void 0:e.code)||(e==null?void 0:e.Code)||n||i||"UnknownError",$fault:"client",$metadata:r});throw $(a,e)},ao=t=>({output:e,parsedBody:s,errorCode:n})=>{io({output:e,parsedBody:s,exceptionCtor:t,errorCode:n})},oo=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),co=t=>{switch(t){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},uo=t=>{const e=[];for(const s in it){const n=it[s];t[n]!==void 0&&e.push({algorithmId:()=>n,checksumConstructor:()=>t[n]})}return{addChecksumAlgorithm(s){e.push(s)},checksumAlgorithms(){return e}}},lo=t=>{const e={};return t.checksumAlgorithms().forEach(s=>{e[s.algorithmId()]=s.checksumConstructor()}),e},ho=t=>({setRetryStrategy(e){t.retryStrategy=e},retryStrategy(){return t.retryStrategy}}),fo=t=>{const e={};return e.retryStrategy=t.retryStrategy(),e},po=t=>Object.assign(uo(t),ho(t)),go=t=>Object.assign(lo(t),fo(t));class Qn{trace(){}debug(){}info(){}warn(){}error(){}}const Zn=(t,e)=>{const s={};for(const n in e)mo(s,t,e,n);return s},mo=(t,e,s,n)=>{if(e!==null){let a=s[n];typeof a=="function"&&(a=[,a]);const[o=yo,c=wo,u=n]=a;(typeof o=="function"&&o(e[u])||typeof o!="function"&&o)&&(t[n]=c(e[u]));return}let[r,i]=s[n];if(typeof i=="function"){let a;const o=r===void 0&&(a=i())!=null,c=typeof r=="function"&&!!r(void 0)||typeof r!="function"&&!!r;o?t[n]=a:c&&(t[n]=i())}else{const a=r===void 0&&i!=null,o=typeof r=="function"&&!!r(i)||typeof r!="function"&&!!r;(a||o)&&(t[n]=i)}},yo=t=>t!=null,wo=t=>t,F=t=>{if(t==null)return{};if(Array.isArray(t))return t.filter(e=>e!=null).map(F);if(typeof t=="object"){const e={};for(const s of Object.keys(t))t[s]!=null&&(e[s]=F(t[s]));return e}return t},bo=(t,e)=>zi(t,e).then(s=>e.utf8Encoder(s)),Jn=(t,e)=>bo(t,e).then(s=>{if(s.length)try{return JSON.parse(s)}catch(n){throw(n==null?void 0:n.name)==="SyntaxError"&&Object.defineProperty(n,"$responseBodyText",{value:s}),n}return{}}),So=async(t,e)=>{const s=await Jn(t,e);return s.message=s.message??s.Message,s},vo=(t,e)=>{const s=(i,a)=>Object.keys(i).find(o=>o.toLowerCase()===a.toLowerCase()),n=i=>{let a=i;return typeof a=="number"&&(a=a.toString()),a.indexOf(",")>=0&&(a=a.split(",")[0]),a.indexOf(":")>=0&&(a=a.split(":")[0]),a.indexOf("#")>=0&&(a=a.split("#")[1]),a},r=s(t.headers,"x-amzn-errortype");if(r!==void 0)return n(t.headers[r]);if(e.code!==void 0)return n(e.code);if(e.__type!==void 0)return n(e.__type)},xo=/\d{12}\.ddb/;async function Eo(t,e,s){var i,a,o,c,u,l,d;const n=s.request;if(((i=n==null?void 0:n.headers)==null?void 0:i["smithy-protocol"])==="rpc-v2-cbor"&&Z(t,"PROTOCOL_RPC_V2_CBOR","M"),typeof e.retryStrategy=="function"){const f=await e.retryStrategy();typeof f.acquireInitialRetryToken=="function"?(o=(a=f.constructor)==null?void 0:a.name)!=null&&o.includes("Adaptive")?Z(t,"RETRY_MODE_ADAPTIVE","F"):Z(t,"RETRY_MODE_STANDARD","E"):Z(t,"RETRY_MODE_LEGACY","D")}if(typeof e.accountIdEndpointMode=="function"){const f=t.endpointV2;switch(String((c=f==null?void 0:f.url)==null?void 0:c.hostname).match(xo)&&Z(t,"ACCOUNT_ID_ENDPOINT","O"),await((u=e.accountIdEndpointMode)==null?void 0:u.call(e))){case"disabled":Z(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":Z(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":Z(t,"ACCOUNT_ID_MODE_REQUIRED","R");break}}const r=(d=(l=t.__smithy_context)==null?void 0:l.selectedHttpAuthScheme)==null?void 0:d.identity;if(r!=null&&r.$source){const f=r;f.accountId&&Z(t,"RESOLVED_ACCOUNT_ID","T");for(const[h,g]of Object.entries(f.$source??{}))Z(t,h,g)}}const js="user-agent",kt="x-amz-user-agent",zs=" ",Tt="/",Ao=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,Co=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,Hs="-",Ro=1024;function _o(t){let e="";for(const s in t){const n=t[s];if(e.length+n.length+1<=Ro){e.length?e+=","+n:e+=n;continue}break}return e}const Do=t=>(e,s)=>async n=>{var h,g,w,m;const{request:r}=n;if(!K.isInstance(r))return e(n);const{headers:i}=r,a=((h=s==null?void 0:s.userAgent)==null?void 0:h.map(Je))||[],o=(await t.defaultUserAgentProvider()).map(Je);await Eo(s,t,n);const c=s;o.push(`m/${_o(Object.assign({},(g=s.__smithy_context)==null?void 0:g.features,(w=c.__aws_sdk_context)==null?void 0:w.features))}`);const u=((m=t==null?void 0:t.customUserAgent)==null?void 0:m.map(Je))||[],l=await t.userAgentAppId();l&&o.push(Je([`app/${l}`]));const d=[].concat([...o,...a,...u]).join(zs),f=[...o.filter(S=>S.startsWith("aws-sdk-")),...u].join(zs);return t.runtime!=="browser"?(f&&(i[kt]=i[kt]?`${i[js]} ${f}`:f),i[js]=d):i[kt]=d,e({...n,request:r})},Je=t=>{var a;const e=t[0].split(Tt).map(o=>o.replace(Ao,Hs)).join(Tt),s=(a=t[1])==null?void 0:a.replace(Co,Hs),n=e.indexOf(Tt),r=e.substring(0,n);let i=e.substring(n+1);return r==="api"&&(i=i.toLowerCase()),[r,i,s].filter(o=>o&&o.length>0).reduce((o,c,u)=>{switch(u){case 0:return c;case 1:return`${o}/${c}`;default:return`${o}#${c}`}},"")},ko={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},To=t=>({applyToStack:e=>{e.add(Do(t),ko)}});var qs;(function(t){t.ENV="env",t.CONFIG="shared config entry"})(qs||(qs={}));const Mo=!1,Io=!1,er=t=>typeof t=="string"&&(t.startsWith("fips-")||t.endsWith("-fips")),Gs=t=>er(t)?["fips-aws-global","aws-fips"].includes(t)?"us-east-1":t.replace(/fips-(dkr-|prod-)?|-fips/,""):t,Po=t=>{const{region:e,useFipsEndpoint:s}=t;if(!e)throw new Error("Region is missing");return Object.assign(t,{region:async()=>{if(typeof e=="string")return Gs(e);const n=await e();return Gs(n)},useFipsEndpoint:async()=>{const n=typeof e=="string"?e:await e();return er(n)?!0:typeof s!="function"?Promise.resolve(!!s):s()}})},Bo=t=>Object.assign(t,{eventStreamMarshaller:t.eventStreamSerdeProvider(t)}),Ws="content-length";function Oo(t){return e=>async s=>{const n=s.request;if(K.isInstance(n)){const{body:r,headers:i}=n;if(r&&Object.keys(i).map(a=>a.toLowerCase()).indexOf(Ws)===-1)try{const a=t(r);n.headers={...n.headers,[Ws]:String(a)}}catch{}}return e({...s,request:n})}}const No={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},Fo=t=>({applyToStack:e=>{e.add(Oo(t.bodyLengthChecker),No)}}),Lo=async t=>{const e=(t==null?void 0:t.Bucket)||"";if(typeof t.Bucket=="string"&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),Ho(e)){if(t.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!zo(e)||e.indexOf(".")!==-1&&!String(t.Endpoint).startsWith("http:")||e.toLowerCase()!==e||e.length<3)&&(t.ForcePathStyle=!0);return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t},Uo=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,$o=/(\d+\.){3}\d+/,jo=/\.\./,zo=t=>Uo.test(t)&&!$o.test(t)&&!jo.test(t),Ho=t=>{const[e,s,n,,,r]=t.split(":"),i=e==="arn"&&t.split(":").length>=6,a=!!(i&&s&&n&&r);if(i&&!a)throw new Error(`Invalid ARN: ${t} was an invalid ARN.`);return a},qo=(t,e,s)=>{const n=async()=>{const r=s[t]??s[e];return typeof r=="function"?r():r};return t==="credentialScope"||e==="CredentialScope"?async()=>{const r=typeof s.credentials=="function"?await s.credentials():s.credentials;return(r==null?void 0:r.credentialScope)??(r==null?void 0:r.CredentialScope)}:t==="accountId"||e==="AccountId"?async()=>{const r=typeof s.credentials=="function"?await s.credentials():s.credentials;return(r==null?void 0:r.accountId)??(r==null?void 0:r.AccountId)}:t==="endpoint"||e==="endpoint"?async()=>{const r=await n();if(r&&typeof r=="object"){if("url"in r)return r.url.href;if("hostname"in r){const{protocol:i,hostname:a,port:o,path:c}=r;return`${i}//${a}${o?":"+o:""}${c}`}}return r}:n},tr=async t=>{};function Go(t){const e={};if(t=t.replace(/^\?/,""),t)for(const s of t.split("&")){let[n,r=null]=s.split("=");n=decodeURIComponent(n),r&&(r=decodeURIComponent(r)),n in e?Array.isArray(e[n])?e[n].push(r):e[n]=[e[n],r]:e[n]=r}return e}const ut=t=>{if(typeof t=="string")return ut(new URL(t));const{hostname:e,pathname:s,port:n,protocol:r,search:i}=t;let a;return i&&(a=Go(i)),{hostname:e,port:n?parseInt(n):void 0,protocol:r,path:s,query:a}},sr=t=>typeof t=="object"?"url"in t?ut(t.url):t:ut(t),Wo=async(t,e,s,n)=>{if(!s.endpoint){let a;s.serviceConfiguredEndpoint?a=await s.serviceConfiguredEndpoint():a=await tr(s.serviceId),a&&(s.endpoint=()=>Promise.resolve(sr(a)))}const r=await Vo(t,e,s);if(typeof s.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return s.endpointProvider(r,n)},Vo=async(t,e,s)=>{var i;const n={},r=((i=e==null?void 0:e.getEndpointParameterInstructions)==null?void 0:i.call(e))||{};for(const[a,o]of Object.entries(r))switch(o.type){case"staticContextParams":n[a]=o.value;break;case"contextParams":n[a]=t[o.name];break;case"clientContextParams":case"builtInParams":n[a]=await qo(o.name,a,s)();break;case"operationContextParams":n[a]=o.get(t);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(o))}return Object.keys(r).length===0&&Object.assign(n,s),String(s.serviceId).toLowerCase()==="s3"&&await Lo(n),n},Ko=({config:t,instructions:e})=>(s,n)=>async r=>{var o,c,u;t.endpoint&&Hi(n,"ENDPOINT_OVERRIDE","N");const i=await Wo(r.input,{getEndpointParameterInstructions(){return e}},{...t},n);n.endpointV2=i,n.authSchemes=(o=i.properties)==null?void 0:o.authSchemes;const a=(c=n.authSchemes)==null?void 0:c[0];if(a){n.signing_region=a.signingRegion,n.signing_service=a.signingName;const l=bt(n),d=(u=l==null?void 0:l.selectedHttpAuthScheme)==null?void 0:u.httpAuthOption;d&&(d.signingProperties=Object.assign(d.signingProperties||{},{signing_region:a.signingRegion,signingRegion:a.signingRegion,signing_service:a.signingName,signingName:a.signingName,signingRegionSet:a.signingRegionSet},a.properties))}return s({...r})},Yo={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:Jt.name},Xo=(t,e)=>({applyToStack:s=>{s.addRelativeTo(Ko({config:t,instructions:e}),Yo)}}),Qo=t=>{const e=t.tls??!0,{endpoint:s,useDualstackEndpoint:n,useFipsEndpoint:r}=t,i=s!=null?async()=>sr(await le(s)()):void 0,o=Object.assign(t,{endpoint:i,tls:e,isCustomEndpoint:!!s,useDualstackEndpoint:le(n??!1),useFipsEndpoint:le(r??!1)});let c;return o.serviceConfiguredEndpoint=async()=>(t.serviceId&&!c&&(c=tr(t.serviceId)),c),o};var ke;(function(t){t.STANDARD="standard",t.ADAPTIVE="adaptive"})(ke||(ke={}));const lt=3,Zo=ke.STANDARD,Jo=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],ec=["TimeoutError","RequestTimeout","RequestTimeoutException"],tc=[500,502,503,504],sc=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],nc=t=>{var e;return(e=t.$metadata)==null?void 0:e.clockSkewCorrected},nr=t=>{var e,s;return((e=t.$metadata)==null?void 0:e.httpStatusCode)===429||Jo.includes(t.name)||((s=t.$retryable)==null?void 0:s.throttling)==!0},rs=(t,e=0)=>{var s;return nc(t)||ec.includes(t.name)||sc.includes((t==null?void 0:t.code)||"")||tc.includes(((s=t.$metadata)==null?void 0:s.httpStatusCode)||0)||t.cause!==void 0&&e<=10&&rs(t.cause,e+1)},rc=t=>{var e;if(((e=t.$metadata)==null?void 0:e.httpStatusCode)!==void 0){const s=t.$metadata.httpStatusCode;return 500<=s&&s<=599&&!rs(t)}return!1};class vt{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=(e==null?void 0:e.beta)??.7,this.minCapacity=(e==null?void 0:e.minCapacity)??1,this.minFillRate=(e==null?void 0:e.minFillRate)??.5,this.scaleConstant=(e==null?void 0:e.scaleConstant)??.4,this.smooth=(e==null?void 0:e.smooth)??.8;const s=this.getCurrentTimeInSeconds();this.lastThrottleTime=s,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const s=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise(n=>vt.setTimeoutFn(n,s))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=e;return}const s=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+s),this.lastTimestamp=e}updateClientSendingRate(e){let s;if(this.updateMeasuredRate(),nr(e)){const r=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=r,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),s=this.cubicThrottle(r),this.enableTokenBucket()}else this.calculateTimeWindow(),s=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(s,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),s=Math.floor(e*2)/2;if(this.requestCount++,s>this.lastTxRateBucket){const n=this.requestCount/(s-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=s}}getPrecise(e){return parseFloat(e.toFixed(8))}}vt.setTimeoutFn=setTimeout;const Ht=100,rr=20*1e3,ic=500,Vs=500,ac=5,oc=10,cc=1,uc="amz-sdk-invocation-id",lc="amz-sdk-request",dc=()=>{let t=Ht;return{computeNextBackoffDelay:n=>Math.floor(Math.min(rr,Math.random()*2**n*t)),setDelayBase:n=>{t=n}}},Ks=({retryDelay:t,retryCount:e,retryCost:s})=>({getRetryCount:()=>e,getRetryDelay:()=>Math.min(rr,t),getRetryCost:()=>s});class ir{constructor(e){this.maxAttempts=e,this.mode=ke.STANDARD,this.capacity=Vs,this.retryBackoffStrategy=dc(),this.maxAttemptsProvider=typeof e=="function"?e:async()=>e}async acquireInitialRetryToken(e){return Ks({retryDelay:Ht,retryCount:0})}async refreshRetryTokenForRetry(e,s){const n=await this.getMaxAttempts();if(this.shouldRetry(e,s,n)){const r=s.errorType;this.retryBackoffStrategy.setDelayBase(r==="THROTTLING"?ic:Ht);const i=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),a=s.retryAfterHint?Math.max(s.retryAfterHint.getTime()-Date.now()||0,i):i,o=this.getCapacityCost(r);return this.capacity-=o,Ks({retryDelay:a,retryCount:e.getRetryCount()+1,retryCost:o})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(Vs,this.capacity+(e.getRetryCost()??cc))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${lt}`),lt}}shouldRetry(e,s,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(s.errorType)&&this.isRetryableError(s.errorType)}getCapacityCost(e){return e==="TRANSIENT"?oc:ac}isRetryableError(e){return e==="THROTTLING"||e==="TRANSIENT"}}class hc{constructor(e,s){this.maxAttemptsProvider=e,this.mode=ke.ADAPTIVE;const{rateLimiter:n}=s??{};this.rateLimiter=n??new vt,this.standardRetryStrategy=new ir(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,s){return this.rateLimiter.updateClientSendingRate(s),this.standardRetryStrategy.refreshRetryTokenForRetry(e,s)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let et;const fc=new Uint8Array(16);function pc(){if(!et&&(et=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!et))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return et(fc)}const U=[];for(let t=0;t<256;++t)U.push((t+256).toString(16).slice(1));function gc(t,e=0){return U[t[e+0]]+U[t[e+1]]+U[t[e+2]]+U[t[e+3]]+"-"+U[t[e+4]]+U[t[e+5]]+"-"+U[t[e+6]]+U[t[e+7]]+"-"+U[t[e+8]]+U[t[e+9]]+"-"+U[t[e+10]]+U[t[e+11]]+U[t[e+12]]+U[t[e+13]]+U[t[e+14]]+U[t[e+15]]}const mc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ys={randomUUID:mc};function yc(t,e,s){if(Ys.randomUUID&&!t)return Ys.randomUUID();t=t||{};const n=t.random||(t.rng||pc)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,gc(n)}const wc=t=>t instanceof Error?t:t instanceof Object?Object.assign(new Error,t):typeof t=="string"?new Error(t):new Error(`AWS SDK error wrapper for ${t}`),bc=t=>{const{retryStrategy:e,retryMode:s,maxAttempts:n}=t,r=le(n??lt);return Object.assign(t,{maxAttempts:r,retryStrategy:async()=>e||(await le(s)()===ke.ADAPTIVE?new hc(r):new ir(r))})},Sc=t=>(t==null?void 0:t.body)instanceof ReadableStream,vc=t=>(e,s)=>async n=>{var a;let r=await t.retryStrategy();const i=await t.maxAttempts();if(xc(r)){r=r;let o=await r.acquireInitialRetryToken(s.partition_id),c=new Error,u=0,l=0;const{request:d}=n,f=K.isInstance(d);for(f&&(d.headers[uc]=yc());;)try{f&&(d.headers[lc]=`attempt=${u+1}; max=${i}`);const{response:h,output:g}=await e(n);return r.recordSuccess(o),g.$metadata.attempts=u+1,g.$metadata.totalRetryDelay=l,{response:h,output:g}}catch(h){const g=Ec(h);if(c=wc(h),f&&Sc(d))throw(a=s.logger instanceof Qn?console:s.logger)==null||a.warn("An error was encountered in a non-retryable streaming request."),c;try{o=await r.refreshRetryTokenForRetry(o,g)}catch{throw c.$metadata||(c.$metadata={}),c.$metadata.attempts=u+1,c.$metadata.totalRetryDelay=l,c}u=o.getRetryCount();const w=o.getRetryDelay();l+=w,await new Promise(m=>setTimeout(m,w))}}else return r=r,r!=null&&r.mode&&(s.userAgent=[...s.userAgent||[],["cfg/retry-mode",r.mode]]),r.retry(e,n)},xc=t=>typeof t.acquireInitialRetryToken<"u"&&typeof t.refreshRetryTokenForRetry<"u"&&typeof t.recordSuccess<"u",Ec=t=>{const e={error:t,errorType:Ac(t)},s=_c(t.$response);return s&&(e.retryAfterHint=s),e},Ac=t=>nr(t)?"THROTTLING":rs(t)?"TRANSIENT":rc(t)?"SERVER_ERROR":"CLIENT_ERROR",Cc={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Rc=t=>({applyToStack:e=>{e.add(vc(t),Cc)}}),_c=t=>{if(!at.isInstance(t))return;const e=Object.keys(t.headers).find(i=>i.toLowerCase()==="retry-after");if(!e)return;const s=t.headers[e],n=Number(s);return Number.isNaN(n)?new Date(s):new Date(n*1e3)},Dc=async(t,e,s)=>({operation:bt(e).operation,region:await le(t.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function kc(t){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"kinesis",region:t.region},propertiesExtractor:(e,s)=>({signingProperties:{config:e,context:s}})}}const Tc=t=>{const e=[];switch(t.operation){default:e.push(kc(t))}return e},Mc=t=>{const e=eo(t);return Object.assign(e,{})},Ic=t=>Object.assign(t,{useDualstackEndpoint:t.useDualstackEndpoint??!1,useFipsEndpoint:t.useFipsEndpoint??!1,defaultSigningName:"kinesis"}),Pc={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},Bc="3.782.0",Oc={version:Bc},Nc=t=>new TextEncoder().encode(t);var Fc=typeof Buffer<"u"&&Buffer.from?function(t){return Buffer.from(t,"utf8")}:Nc;function Ge(t){return t instanceof Uint8Array?t:typeof t=="string"?Fc(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}function qt(t){return typeof t=="string"?t.length===0:t.byteLength===0}function Lc(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),s=0;s<t.length;)e[s]=t[s],s+=1;return e}return Uint32Array.from(t)}var ar={name:"SHA-256"},Xs={name:"HMAC",hash:ar},Uc=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const $c={};function nt(){return typeof window<"u"?window:typeof self<"u"?self:$c}var jc=function(){function t(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return t.prototype.update=function(e){if(!qt(e)){var s=Ge(e),n=new Uint8Array(this.toHash.byteLength+s.byteLength);n.set(this.toHash,0),n.set(s,this.toHash.byteLength),this.toHash=n}},t.prototype.digest=function(){var e=this;return this.key?this.key.then(function(s){return nt().crypto.subtle.sign(Xs,s,e.toHash).then(function(n){return new Uint8Array(n)})}):qt(this.toHash)?Promise.resolve(Uc):Promise.resolve().then(function(){return nt().crypto.subtle.digest(ar,e.toHash)}).then(function(s){return Promise.resolve(new Uint8Array(s))})},t.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(s,n){nt().crypto.subtle.importKey("raw",Ge(e.secret),Xs,!1,["sign"]).then(s,n)}),this.key.catch(function(){}))},t}();function zc(t,e,s,n){function r(i){return i instanceof s?i:new s(function(a){a(i)})}return new(s||(s=Promise))(function(i,a){function o(l){try{u(n.next(l))}catch(d){a(d)}}function c(l){try{u(n.throw(l))}catch(d){a(d)}}function u(l){l.done?i(l.value):r(l.value).then(o,c)}u((n=n.apply(t,e||[])).next())})}function Hc(t,e){var s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,r,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(s=0)),s;)try{if(n=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){s=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(u[0]===6&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=e.call(t,s)}catch(l){u=[6,l],r=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function qc(t){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&t[e],n=0;if(s)return s.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Q=64,Gc=32,Wc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vc=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Kc=Math.pow(2,53)-1,rt=function(){function t(){this.state=Int32Array.from(Vc),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var s=0,n=e.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>Kc)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=e[s++],n--,this.bufferLength===Q&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,s=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(s.setUint8(this.bufferLength++,128),n%Q>=Q-8){for(var r=this.bufferLength;r<Q;r++)s.setUint8(r,0);this.hashBuffer(),this.bufferLength=0}for(var r=this.bufferLength;r<Q-8;r++)s.setUint8(r,0);s.setUint32(Q-8,Math.floor(e/4294967296),!0),s.setUint32(Q-4,e),this.hashBuffer(),this.finished=!0}for(var i=new Uint8Array(Gc),r=0;r<8;r++)i[r*4]=this.state[r]>>>24&255,i[r*4+1]=this.state[r]>>>16&255,i[r*4+2]=this.state[r]>>>8&255,i[r*4+3]=this.state[r]>>>0&255;return i},t.prototype.hashBuffer=function(){for(var e=this,s=e.buffer,n=e.state,r=n[0],i=n[1],a=n[2],o=n[3],c=n[4],u=n[5],l=n[6],d=n[7],f=0;f<Q;f++){if(f<16)this.temp[f]=(s[f*4]&255)<<24|(s[f*4+1]&255)<<16|(s[f*4+2]&255)<<8|s[f*4+3]&255;else{var h=this.temp[f-2],g=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10;h=this.temp[f-15];var w=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[f]=(g+this.temp[f-7]|0)+(w+this.temp[f-16]|0)}var m=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&u^~c&l)|0)+(d+(Wc[f]+this.temp[f]|0)|0)|0,S=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&a^i&a)|0;d=l,l=u,u=c,c=o+m|0,o=a,a=i,i=r,r=m+S|0}n[0]+=r,n[1]+=i,n[2]+=a,n[3]+=o,n[4]+=c,n[5]+=u,n[6]+=l,n[7]+=d},t}(),Yc=function(){function t(e){this.secret=e,this.hash=new rt,this.reset()}return t.prototype.update=function(e){if(!(qt(e)||this.error))try{this.hash.update(Ge(e))}catch(s){this.error=s}},t.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},t.prototype.digest=function(){return zc(this,void 0,void 0,function(){return Hc(this,function(e){return[2,this.digestSync()]})})},t.prototype.reset=function(){if(this.hash=new rt,this.secret){this.outer=new rt;var e=Xc(this.secret),s=new Uint8Array(Q);s.set(e);for(var n=0;n<Q;n++)e[n]^=54,s[n]^=92;this.hash.update(e),this.outer.update(s);for(var n=0;n<e.byteLength;n++)e[n]=0}},t}();function Xc(t){var e=Ge(t);if(e.byteLength>Q){var s=new rt;s.update(e),e=s.digest()}var n=new Uint8Array(Q);return n.set(e),n}var Qc=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Zc(t){if(Jc(t)&&typeof t.crypto.subtle=="object"){var e=t.crypto.subtle;return eu(e)}return!1}function Jc(t){if(typeof t=="object"&&typeof t.crypto=="object"){var e=t.crypto.getRandomValues;return typeof e=="function"}return!1}function eu(t){return t&&Qc.every(function(e){return typeof t[e]=="function"})}var tu=function(){function t(e){Zc(nt())?this.hash=new jc(e):this.hash=new Yc(e)}return t.prototype.update=function(e,s){this.hash.update(Ge(e))},t.prototype.digest=function(){return this.hash.digest()},t.prototype.reset=function(){this.hash.reset()},t}();const su={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},or={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},N={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},z={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},oe={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class p{static getFirstMatch(e,s){const n=s.match(e);return n&&n.length>0&&n[1]||""}static getSecondMatch(e,s){const n=s.match(e);return n&&n.length>1&&n[2]||""}static matchAndReturnConst(e,s,n){if(e.test(s))return n}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const s=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(s.push(0),s[0]===10)switch(s[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const s=e.split(".").splice(0,2).map(n=>parseInt(n,10)||0);if(s.push(0),!(s[0]===1&&s[1]<5)){if(s[0]===1&&s[1]<6)return"Cupcake";if(s[0]===1&&s[1]>=6)return"Donut";if(s[0]===2&&s[1]<2)return"Eclair";if(s[0]===2&&s[1]===2)return"Froyo";if(s[0]===2&&s[1]>2)return"Gingerbread";if(s[0]===3)return"Honeycomb";if(s[0]===4&&s[1]<1)return"Ice Cream Sandwich";if(s[0]===4&&s[1]<4)return"Jelly Bean";if(s[0]===4&&s[1]>=4)return"KitKat";if(s[0]===5)return"Lollipop";if(s[0]===6)return"Marshmallow";if(s[0]===7)return"Nougat";if(s[0]===8)return"Oreo";if(s[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,s,n=!1){const r=p.getVersionPrecision(e),i=p.getVersionPrecision(s);let a=Math.max(r,i),o=0;const c=p.map([e,s],u=>{const l=a-p.getVersionPrecision(u),d=u+new Array(l+1).join(".0");return p.map(d.split("."),f=>new Array(20-f.length).join("0")+f).reverse()});for(n&&(o=a-Math.min(r,i)),a-=1;a>=o;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===o)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}}static map(e,s){const n=[];let r;if(Array.prototype.map)return Array.prototype.map.call(e,s);for(r=0;r<e.length;r+=1)n.push(s(e[r]));return n}static find(e,s){let n,r;if(Array.prototype.find)return Array.prototype.find.call(e,s);for(n=0,r=e.length;n<r;n+=1){const i=e[n];if(s(i,n))return i}}static assign(e,...s){const n=e;let r,i;if(Object.assign)return Object.assign(e,...s);for(r=0,i=s.length;r<i;r+=1){const a=s[r];typeof a=="object"&&a!==null&&Object.keys(a).forEach(c=>{n[c]=a[c]})}return e}static getBrowserAlias(e){return su[e]}static getBrowserTypeByAlias(e){return or[e]||""}}const P=/version\/(\d+(\.?_?\d+)+)/i,nu=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},s=p.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},s=p.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},s=p.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},s=p.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},s=p.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},s=p.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},s=p.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},s=p.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},s=p.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},s=p.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},s=p.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},s=p.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},s=p.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},s=p.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},s=p.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return s&&(e.version=s),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},s=p.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},s=p.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},s=p.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},s=p.getFirstMatch(P,t)||p.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},s=p.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},s=p.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},s=p.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},s=p.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},s=p.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},s=p.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},s=p.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},s=p.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},s=p.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test(t){const e=!t.test(/like android/i),s=t.test(/android/i);return e&&s},describe(t){const e={name:"Android Browser"},s=p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},s=p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},s=p.getFirstMatch(P,t);return s&&(e.version=s),e}},{test:[/.*/i],describe(t){const e=/^(.*)\/(.*) /,s=/^(.*)\/(.*)[ \t]\((.*)/,r=t.search("\\(")!==-1?s:e;return{name:p.getFirstMatch(r,t),version:p.getSecondMatch(r,t)}}}],ru=[{test:[/Roku\/DVP/],describe(t){const e=p.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:z.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=p.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:z.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=p.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),s=p.getWindowsVersionName(e);return{name:z.Windows,version:e,versionName:s}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:z.iOS},s=p.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return s&&(e.version=s),e}},{test:[/macintosh/i],describe(t){const e=p.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),s=p.getMacOSVersionName(e),n={name:z.MacOS,version:e};return s&&(n.versionName=s),n}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=p.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:z.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),s=t.test(/android/i);return e&&s},describe(t){const e=p.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),s=p.getAndroidVersionName(e),n={name:z.Android,version:e};return s&&(n.versionName=s),n}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=p.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),s={name:z.WebOS};return e&&e.length&&(s.version=e),s}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=p.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||p.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||p.getFirstMatch(/\bbb(\d+)/i,t);return{name:z.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=p.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:z.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=p.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:z.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:z.Linux}}},{test:[/CrOS/],describe(){return{name:z.ChromeOS}}},{test:[/PlayStation 4/],describe(t){const e=p.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:z.PlayStation4,version:e}}}],iu=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(t){const e=p.getFirstMatch(/(can-l01)/i,t)&&"Nova",s={type:N.mobile,vendor:"Huawei"};return e&&(s.model=e),s}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:N.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:N.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:N.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:N.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:N.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:N.tablet}}},{test(t){const e=t.test(/ipod|iphone/i),s=t.test(/like (ipod|iphone)/i);return e&&!s},describe(t){const e=p.getFirstMatch(/(ipod|iphone)/i,t);return{type:N.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:N.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:N.mobile}}},{test(t){return t.getBrowserName(!0)==="blackberry"},describe(){return{type:N.mobile,vendor:"BlackBerry"}}},{test(t){return t.getBrowserName(!0)==="bada"},describe(){return{type:N.mobile}}},{test(t){return t.getBrowserName()==="windows phone"},describe(){return{type:N.mobile,vendor:"Microsoft"}}},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe(){return{type:N.tablet}}},{test(t){return t.getOSName(!0)==="android"},describe(){return{type:N.mobile}}},{test(t){return t.getOSName(!0)==="macos"},describe(){return{type:N.desktop,vendor:"Apple"}}},{test(t){return t.getOSName(!0)==="windows"},describe(){return{type:N.desktop}}},{test(t){return t.getOSName(!0)==="linux"},describe(){return{type:N.desktop}}},{test(t){return t.getOSName(!0)==="playstation 4"},describe(){return{type:N.tv}}},{test(t){return t.getOSName(!0)==="roku"},describe(){return{type:N.tv}}}],au=[{test(t){return t.getBrowserName(!0)==="microsoft edge"},describe(t){if(/\sedg\//i.test(t))return{name:oe.Blink};const s=p.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:oe.EdgeHTML,version:s}}},{test:[/trident/i],describe(t){const e={name:oe.Trident},s=p.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test(t){return t.test(/presto/i)},describe(t){const e={name:oe.Presto},s=p.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test(t){const e=t.test(/gecko/i),s=t.test(/like gecko/i);return e&&!s},describe(t){const e={name:oe.Gecko},s=p.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:oe.Blink}}},{test:[/(apple)?webkit/i],describe(t){const e={name:oe.WebKit},s=p.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return s&&(e.version=s),e}}];class Qs{constructor(e,s=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},s!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=p.find(nu,s=>{if(typeof s.test=="function")return s.test(this);if(s.test instanceof Array)return s.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=p.find(ru,s=>{if(typeof s.test=="function")return s.test(this);if(s.test instanceof Array)return s.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:s}=this.getOS();return e?String(s).toLowerCase()||"":s||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:s}=this.getPlatform();return e?String(s).toLowerCase()||"":s||""}parsePlatform(){this.parsedResult.platform={};const e=p.find(iu,s=>{if(typeof s.test=="function")return s.test(this);if(s.test instanceof Array)return s.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=p.find(au,s=>{if(typeof s.test=="function")return s.test(this);if(s.test instanceof Array)return s.test.some(n=>this.test(n));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return p.assign({},this.parsedResult)}satisfies(e){const s={};let n=0;const r={};let i=0;if(Object.keys(e).forEach(o=>{const c=e[o];typeof c=="string"?(r[o]=c,i+=1):typeof c=="object"&&(s[o]=c,n+=1)}),n>0){const o=Object.keys(s),c=p.find(o,l=>this.isOS(l));if(c){const l=this.satisfies(s[c]);if(l!==void 0)return l}const u=p.find(o,l=>this.isPlatform(l));if(u){const l=this.satisfies(s[u]);if(l!==void 0)return l}}if(i>0){const o=Object.keys(r),c=p.find(o,u=>this.isBrowser(u,!0));if(c!==void 0)return this.compareVersion(r[c])}}isBrowser(e,s=!1){const n=this.getBrowserName().toLowerCase();let r=e.toLowerCase();const i=p.getBrowserTypeByAlias(r);return s&&i&&(r=i.toLowerCase()),r===n}compareVersion(e){let s=[0],n=e,r=!1;const i=this.getBrowserVersion();if(typeof i=="string")return e[0]===">"||e[0]==="<"?(n=e.substr(1),e[1]==="="?(r=!0,n=e.substr(2)):s=[],e[0]===">"?s.push(1):s.push(-1)):e[0]==="="?n=e.substr(1):e[0]==="~"&&(r=!0,n=e.substr(1)),s.indexOf(p.compareVersions(i,n,r))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,s=!1){return this.isBrowser(e,s)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(s=>this.is(s))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class cr{static getParser(e,s=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new Qs(e,s)}static parse(e){return new Qs(e).getResult()}static get BROWSER_MAP(){return or}static get ENGINE_MAP(){return oe}static get OS_MAP(){return z}static get PLATFORMS_MAP(){return N}}const ou=({serviceId:t,clientVersion:e})=>async s=>{var a,o,c,u,l,d;const n=typeof window<"u"&&((a=window==null?void 0:window.navigator)!=null&&a.userAgent)?cr.parse(window.navigator.userAgent):void 0,r=[["aws-sdk-js",e],["ua","2.1"],[`os/${((o=n==null?void 0:n.os)==null?void 0:o.name)||"other"}`,(c=n==null?void 0:n.os)==null?void 0:c.version],["lang/js"],["md/browser",`${((u=n==null?void 0:n.browser)==null?void 0:u.name)??"unknown"}_${((l=n==null?void 0:n.browser)==null?void 0:l.version)??"unknown"}`]];t&&r.push([`api/${t}`,e]);const i=await((d=s==null?void 0:s.userAgentAppId)==null?void 0:d.call(s));return i&&r.push([`app/${i}`]),r};var ur=function(){function t(){this.checksum=4294967295}return t.prototype.update=function(e){var s,n;try{for(var r=qc(e),i=r.next();!i.done;i=r.next()){var a=i.value;this.checksum=this.checksum>>>8^uu[(this.checksum^a)&255]}}catch(o){s={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return this},t.prototype.digest=function(){return(this.checksum^4294967295)>>>0},t}(),cu=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],uu=Lc(cu);class je{constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const s=new Uint8Array(8);for(let n=7,r=Math.abs(Math.round(e));n>-1&&r>0;n--,r/=256)s[n]=r;return e<0&&Zs(s),new je(s)}valueOf(){const e=this.bytes.slice(0),s=e[0]&128;return s&&Zs(e),parseInt(V(e),16)*(s?-1:1)}toString(){return String(this.valueOf())}}function Zs(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}class lu{constructor(e,s){this.toUtf8=e,this.fromUtf8=s}format(e){const s=[];for(const i of Object.keys(e)){const a=this.fromUtf8(i);s.push(Uint8Array.from([a.byteLength]),a,this.formatHeaderValue(e[i]))}const n=new Uint8Array(s.reduce((i,a)=>i+a.byteLength,0));let r=0;for(const i of s)n.set(i,r),r+=i.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const s=new DataView(new ArrayBuffer(3));return s.setUint8(0,3),s.setInt16(1,e.value,!1),new Uint8Array(s.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const a=new Uint8Array(i.buffer);return a.set(e.value,3),a;case"string":const o=this.fromUtf8(e.value),c=new DataView(new ArrayBuffer(3+o.byteLength));c.setUint8(0,7),c.setUint16(1,o.byteLength,!1);const u=new Uint8Array(c.buffer);return u.set(o,3),u;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(je.fromNumber(e.value.valueOf()).bytes,1),l;case"uuid":if(!bu.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(Mn(e.value.replace(/\-/g,"")),1),d}}parse(e){const s={};let n=0;for(;n<e.byteLength;){const r=e.getUint8(n++),i=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,r));switch(n+=r,e.getUint8(n++)){case 0:s[i]={type:en,value:!0};break;case 1:s[i]={type:en,value:!1};break;case 2:s[i]={type:du,value:e.getInt8(n++)};break;case 3:s[i]={type:hu,value:e.getInt16(n,!1)},n+=2;break;case 4:s[i]={type:fu,value:e.getInt32(n,!1)},n+=4;break;case 5:s[i]={type:pu,value:new je(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:const a=e.getUint16(n,!1);n+=2,s[i]={type:gu,value:new Uint8Array(e.buffer,e.byteOffset+n,a)},n+=a;break;case 7:const o=e.getUint16(n,!1);n+=2,s[i]={type:mu,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,o))},n+=o;break;case 8:s[i]={type:yu,value:new Date(new je(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const c=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,s[i]={type:wu,value:`${V(c.subarray(0,4))}-${V(c.subarray(4,6))}-${V(c.subarray(6,8))}-${V(c.subarray(8,10))}-${V(c.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return s}}var Js;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(Js||(Js={}));const en="boolean",du="byte",hu="short",fu="integer",pu="long",gu="binary",mu="string",yu="timestamp",wu="uuid",bu=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,lr=4,ce=lr*2,ge=4,Su=ce+ge*2;function vu({byteLength:t,byteOffset:e,buffer:s}){if(t<Su)throw new Error("Provided message too short to accommodate event stream message overhead");const n=new DataView(s,e,t),r=n.getUint32(0,!1);if(t!==r)throw new Error("Reported message length does not match received message length");const i=n.getUint32(lr,!1),a=n.getUint32(ce,!1),o=n.getUint32(t-ge,!1),c=new ur().update(new Uint8Array(s,e,ce));if(a!==c.digest())throw new Error(`The prelude checksum specified in the message (${a}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(s,e+ce,t-(ce+ge))),o!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${o}`);return{headers:new DataView(s,e+ce+ge,i),body:new Uint8Array(s,e+ce+ge+i,r-i-(ce+ge+ge))}}class xu{constructor(e,s){this.headerMarshaller=new lu(e,s),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),s=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return s}}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const s=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return s}}}encode({headers:e,body:s}){const n=this.headerMarshaller.format(e),r=n.byteLength+s.byteLength+16,i=new Uint8Array(r),a=new DataView(i.buffer,i.byteOffset,i.byteLength),o=new ur;return a.setUint32(0,r,!1),a.setUint32(4,n.byteLength,!1),a.setUint32(8,o.update(i.subarray(0,8)).digest(),!1),i.set(n,12),i.set(s,n.byteLength+12),a.setUint32(r-4,o.update(i.subarray(8,r-4)).digest(),!1),i}decode(e){const{headers:s,body:n}=vu(e);return{headers:this.headerMarshaller.parse(s),body:n}}formatHeaders(e){return this.headerMarshaller.format(e)}}class Eu{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.decoder.decode(e)}}class Au{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream)yield this.options.encoder.encode(e);this.options.includeEndFrame&&(yield new Uint8Array(0))}}class Cu{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const s=await this.options.deserializer(e);s!==void 0&&(yield s)}}}class Ru{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream)yield this.options.serializer(e)}}function _u(t){let e=0,s=0,n=null,r=null;const i=o=>{if(typeof o!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+o);e=o,s=4,n=new Uint8Array(o),new DataView(n.buffer).setUint32(0,o,!1)},a=async function*(){const o=t[Symbol.asyncIterator]();for(;;){const{value:c,done:u}=await o.next();if(u){if(e)if(e===s)yield n;else throw new Error("Truncated event message received.");else return;return}const l=c.length;let d=0;for(;d<l;){if(!n){const h=l-d;r||(r=new Uint8Array(4));const g=Math.min(4-s,h);if(r.set(c.slice(d,d+g),s),s+=g,d+=g,s<4)break;i(new DataView(r.buffer).getUint32(0,!1)),r=null}const f=Math.min(e-s,l-d);n.set(c.slice(d,d+f),s),s+=f,d+=f,e&&e===s&&(yield n,n=null,e=0,s=0)}}};return{[Symbol.asyncIterator]:a}}function Du(t,e){return async function(s){const{value:n}=s.headers[":message-type"];if(n==="error"){const r=new Error(s.headers[":error-message"].value||"UnknownError");throw r.name=s.headers[":error-code"].value,r}else if(n==="exception"){const r=s.headers[":exception-type"].value,i={[r]:s},a=await t(i);if(a.$unknown){const o=new Error(e(s.body));throw o.name=r,o}throw a[r]}else if(n==="event"){const r={[s.headers[":event-type"].value]:s},i=await t(r);return i.$unknown?void 0:i}else throw Error(`Unrecognizable event type: ${s.headers[":event-type"].value}`)}}let ku=class{constructor({utf8Encoder:e,utf8Decoder:s}){this.eventStreamCodec=new xu(e,s),this.utfEncoder=e}deserialize(e,s){const n=_u(e);return new Cu({messageStream:new Eu({inputStream:n,decoder:this.eventStreamCodec}),deserializer:Du(s,this.utfEncoder)})}serialize(e,s){return new Au({messageStream:new Ru({inputStream:e,serializer:s}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const Tu=t=>({[Symbol.asyncIterator]:async function*(){const e=t.getReader();try{for(;;){const{done:s,value:n}=await e.read();if(s)return;yield n}}finally{e.releaseLock()}}}),Mu=t=>{const e=t[Symbol.asyncIterator]();return new ReadableStream({async pull(s){const{done:n,value:r}=await e.next();if(n)return s.close();s.enqueue(r)}})};class Iu{constructor({utf8Encoder:e,utf8Decoder:s}){this.universalMarshaller=new ku({utf8Decoder:s,utf8Encoder:e})}deserialize(e,s){const n=Pu(e)?Tu(e):e;return this.universalMarshaller.deserialize(n,s)}serialize(e,s){const n=this.universalMarshaller.serialize(e,s);return typeof ReadableStream=="function"?Mu(n):n}}const Pu=t=>typeof ReadableStream=="function"&&t instanceof ReadableStream,Bu=t=>new Iu(t),Ou=t=>()=>Promise.reject(t),tn=typeof TextEncoder=="function"?new TextEncoder:null,Nu=t=>{if(typeof t=="string"){if(tn)return tn.encode(t).byteLength;let e=t.length;for(let s=e-1;s>=0;s--){const n=t.charCodeAt(s);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&s--}return e}else{if(typeof t.byteLength=="number")return t.byteLength;if(typeof t.size=="number")return t.size}throw new Error(`Body Length computation failed for ${t}`)},dr="required",b="type",D="rules",_="conditions",x="fn",E="argv",I="ref",ze="assign",J="url",ee="properties",te="headers",Fu=!0,Se="isSet",me="stringEquals",Mt="aws.parseArn",ye="arn",H="booleanEquals",q="endpoint",T="tree",M="error",Ae={[dr]:!1,[b]:"String"},sn={[dr]:!0,default:!1,[b]:"Boolean"},It={[x]:"not",[E]:[{[x]:Se,[E]:[{[I]:"Endpoint"}]}]},hr={[I]:"Endpoint"},tt={[x]:Se,[E]:[{[I]:"Region"}]},st={[x]:"aws.partition",[E]:[{[I]:"Region"}],[ze]:"PartitionResult"},Pt={[x]:"not",[E]:[{[x]:me,[E]:[{[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"name"]},"aws-iso"]}]},is={[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"name"]},Bt={[x]:"not",[E]:[{[x]:me,[E]:[is,"aws-iso-b"]}]},dt={[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"supportsFIPS"]},X={},fr={[M]:"FIPS is enabled but this partition does not support FIPS",[b]:M},pr={[M]:"DualStack is enabled but this partition does not support DualStack",[b]:M},Ot={[M]:"Invalid ARN: Failed to parse ARN.",[b]:M},nn={[x]:H,[E]:[!0,{[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"supportsDualStack"]}]},rn=[{[I]:"StreamARN"}],Lu=[{[x]:Se,[E]:[hr]}],Nt=[{[_]:[{[x]:"isValidHostLabel",[E]:[{[x]:"getAttr",[E]:[{[I]:ye},"accountId"]},!1]}],[D]:[{[_]:[{[x]:"isValidHostLabel",[E]:[{[x]:"getAttr",[E]:[{[I]:ye},"region"]},!1]}],[D]:[{[_]:[{[x]:me,[E]:[{[x]:"getAttr",[E]:[{[I]:ye},"service"]},"kinesis"]}],[D]:[{[_]:[{[x]:"getAttr",[E]:[{[I]:ye},"resourceId[0]"],[ze]:"arnType"},{[x]:"not",[E]:[{[x]:me,[E]:[{[I]:"arnType"},""]}]}],[D]:[{[_]:[{[x]:me,[E]:[{[I]:"arnType"},"stream"]}],[D]:[{[_]:[{[x]:me,[E]:[is,"{arn#partition}"]}],[D]:[{[_]:[{[x]:Se,[E]:[{[I]:"OperationType"}]}],[D]:[{[_]:[{[x]:H,[E]:[{[I]:"UseFIPS"},!0]},{[x]:H,[E]:[{[I]:"UseDualStack"},!0]}],[D]:[{[_]:[{[x]:H,[E]:[dt,!0]}],[D]:[{[_]:[{[x]:H,[E]:[{[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"supportsDualStack"]},!0]}],[D]:[{[q]:{[J]:"https://{arn#accountId}.{OperationType}-kinesis-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",[ee]:{},[te]:{}},[b]:q}],[b]:T},{[M]:"DualStack is enabled, but this partition does not support DualStack.",[b]:M}],[b]:T},{[M]:"FIPS is enabled, but this partition does not support FIPS.",[b]:M}],[b]:T},{[_]:[{[x]:H,[E]:[{[I]:"UseFIPS"},!0]}],[D]:[{[_]:[{[x]:H,[E]:[dt,!0]}],[D]:[{[q]:{[J]:"https://{arn#accountId}.{OperationType}-kinesis-fips.{Region}.{PartitionResult#dnsSuffix}",[ee]:{},[te]:{}},[b]:q}],[b]:T},fr],[b]:T},{[_]:[{[x]:H,[E]:[{[I]:"UseDualStack"},!0]}],[D]:[{[_]:[{[x]:H,[E]:[{[x]:"getAttr",[E]:[{[I]:"PartitionResult"},"supportsDualStack"]},!0]}],[D]:[{[q]:{[J]:"https://{arn#accountId}.{OperationType}-kinesis.{Region}.{PartitionResult#dualStackDnsSuffix}",[ee]:{},[te]:{}},[b]:q}],[b]:T},pr],[b]:T},{[q]:{[J]:"https://{arn#accountId}.{OperationType}-kinesis.{Region}.{PartitionResult#dnsSuffix}",[ee]:{},[te]:{}},[b]:q}],[b]:T},{[M]:"Operation Type is not set. Please contact service team for resolution.",[b]:M}],[b]:T},{[M]:"Partition: {arn#partition} from ARN doesn't match with partition name: {PartitionResult#name}.",[b]:M}],[b]:T},{[M]:"Invalid ARN: Kinesis ARNs don't support `{arnType}` arn types.",[b]:M}],[b]:T},{[M]:"Invalid ARN: No ARN type specified",[b]:M}],[b]:T},{[M]:"Invalid ARN: The ARN was not for the Kinesis service, found: {arn#service}.",[b]:M}],[b]:T},{[M]:"Invalid ARN: Invalid region.",[b]:M}],[b]:T},{[M]:"Invalid ARN: Invalid account id.",[b]:M}],Uu=[{[x]:H,[E]:[{[I]:"UseFIPS"},!0]},{[x]:H,[E]:[{[I]:"UseDualStack"},!0]}],$u=[{[x]:H,[E]:[dt,!0]}],an=[{[x]:H,[E]:[{[I]:"UseFIPS"},!0]}],on=[{[x]:H,[E]:[{[I]:"UseDualStack"},!0]}],cn=[{[I]:"ConsumerARN"}],un=[{[I]:"ResourceARN"}],ju={parameters:{Region:Ae,UseDualStack:sn,UseFIPS:sn,Endpoint:Ae,StreamARN:Ae,OperationType:Ae,ConsumerARN:Ae,ResourceARN:Ae},[D]:[{[_]:[{[x]:Se,[E]:rn},It,tt,st,Pt,Bt],[D]:[{[_]:[{[x]:Mt,[E]:rn,[ze]:ye}],[D]:Nt,[b]:T},Ot],[b]:T},{[_]:[{[x]:Se,[E]:cn},It,tt,st,Pt,Bt],[D]:[{[_]:[{[x]:Mt,[E]:cn,[ze]:ye}],[D]:Nt,[b]:T},Ot],[b]:T},{[_]:[{[x]:Se,[E]:un},It,tt,st,Pt,Bt],[D]:[{[_]:[{[x]:Mt,[E]:un,[ze]:ye}],[D]:Nt,[b]:T},Ot],[b]:T},{[_]:Lu,[D]:[{[_]:an,error:"Invalid Configuration: FIPS and custom endpoint are not supported",[b]:M},{[_]:on,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",[b]:M},{endpoint:{[J]:hr,[ee]:X,[te]:X},[b]:q}],[b]:T},{[_]:[tt],[D]:[{[_]:[st],[D]:[{[_]:Uu,[D]:[{[_]:[{[x]:H,[E]:[Fu,dt]},nn],[D]:[{endpoint:{[J]:"https://kinesis-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",[ee]:X,[te]:X},[b]:q}],[b]:T},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",[b]:M}],[b]:T},{[_]:an,[D]:[{[_]:$u,[D]:[{[_]:[{[x]:me,[E]:[is,"aws-us-gov"]}],endpoint:{[J]:"https://kinesis.{Region}.amazonaws.com",[ee]:X,[te]:X},[b]:q},{endpoint:{[J]:"https://kinesis-fips.{Region}.{PartitionResult#dnsSuffix}",[ee]:X,[te]:X},[b]:q}],[b]:T},fr],[b]:T},{[_]:on,[D]:[{[_]:[nn],[D]:[{endpoint:{[J]:"https://kinesis.{Region}.{PartitionResult#dualStackDnsSuffix}",[ee]:X,[te]:X},[b]:q}],[b]:T},pr],[b]:T},{endpoint:{[J]:"https://kinesis.{Region}.{PartitionResult#dnsSuffix}",[ee]:X,[te]:X},[b]:q}],[b]:T}],[b]:T},{error:"Invalid Configuration: Missing Region",[b]:M}]},zu=ju,Hu=new Zi({size:50,params:["ConsumerARN","Endpoint","OperationType","Region","ResourceARN","StreamARN","UseDualStack","UseFIPS"]}),qu=(t,e={})=>Hu.get(t,()=>ya(zu,{endpointParams:t,logger:e.logger}));ot.aws=jn;const Gu=t=>({apiVersion:"2013-12-02",base64Decoder:(t==null?void 0:t.base64Decoder)??es,base64Encoder:(t==null?void 0:t.base64Encoder)??kn,disableHostPrefix:(t==null?void 0:t.disableHostPrefix)??!1,endpointProvider:(t==null?void 0:t.endpointProvider)??qu,extensions:(t==null?void 0:t.extensions)??[],httpAuthSchemeProvider:(t==null?void 0:t.httpAuthSchemeProvider)??Tc,httpAuthSchemes:(t==null?void 0:t.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new _a}],logger:(t==null?void 0:t.logger)??new Qn,serviceId:(t==null?void 0:t.serviceId)??"Kinesis",urlParser:(t==null?void 0:t.urlParser)??ut,utf8Decoder:(t==null?void 0:t.utf8Decoder)??De,utf8Encoder:(t==null?void 0:t.utf8Encoder)??Dn}),Wu=["in-region","cross-region","mobile","standard","legacy"],Vu=({defaultsMode:t}={})=>Da(async()=>{const e=typeof t=="function"?await t():t;switch(e==null?void 0:e.toLowerCase()){case"auto":return Promise.resolve(Ku()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(e==null?void 0:e.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${Wu.join(", ")}, got ${e}`)}}),Ku=()=>{var s,n;const t=typeof window<"u"&&((s=window==null?void 0:window.navigator)!=null&&s.userAgent)?cr.parse(window.navigator.userAgent):void 0,e=(n=t==null?void 0:t.platform)==null?void 0:n.type;return e==="tablet"||e==="mobile"},Yu=t=>{const e=Vu(t),s=()=>e().then(co),n=Gu(t);return{...n,...t,runtime:"browser",defaultsMode:e,bodyLengthChecker:(t==null?void 0:t.bodyLengthChecker)??Nu,credentialDefaultProvider:(t==null?void 0:t.credentialDefaultProvider)??(r=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(t==null?void 0:t.defaultUserAgentProvider)??ou({serviceId:n.serviceId,clientVersion:Oc.version}),eventStreamSerdeProvider:(t==null?void 0:t.eventStreamSerdeProvider)??Bu,maxAttempts:(t==null?void 0:t.maxAttempts)??lt,region:(t==null?void 0:t.region)??Ou("Region is missing"),requestHandler:ts.create((t==null?void 0:t.requestHandler)??s),retryMode:(t==null?void 0:t.retryMode)??(async()=>(await s()).retryMode||Zo),sha256:(t==null?void 0:t.sha256)??tu,streamCollector:(t==null?void 0:t.streamCollector)??Li,useDualstackEndpoint:(t==null?void 0:t.useDualstackEndpoint)??(()=>Promise.resolve(Mo)),useFipsEndpoint:(t==null?void 0:t.useFipsEndpoint)??(()=>Promise.resolve(Io))}},Xu=t=>({setRegion(e){t.region=e},region(){return t.region}}),Qu=t=>({region:t.region()}),Zu=t=>{const e=t.httpAuthSchemes;let s=t.httpAuthSchemeProvider,n=t.credentials;return{setHttpAuthScheme(r){const i=e.findIndex(a=>a.schemeId===r.schemeId);i===-1?e.push(r):e.splice(i,1,r)},httpAuthSchemes(){return e},setHttpAuthSchemeProvider(r){s=r},httpAuthSchemeProvider(){return s},setCredentials(r){n=r},credentials(){return n}}},Ju=t=>({httpAuthSchemes:t.httpAuthSchemes(),httpAuthSchemeProvider:t.httpAuthSchemeProvider(),credentials:t.credentials()}),el=(t,e)=>{const s=Object.assign(Xu(t),po(t),ii(t),Zu(t));return e.forEach(n=>n.configure(s)),Object.assign(t,Qu(s),go(s),ai(s),Ju(s))};class tl extends no{constructor(...[s]){const n=Yu(s||{});super(n);A(this,"config");this.initConfig=n;const r=Ic(n),i=Qi(r),a=bc(i),o=Po(a),c=o,u=Qo(c),l=Bo(u),d=Mc(l),f=el(d,(s==null?void 0:s.extensions)||[]);this.config=f,this.middlewareStack.use(To(this.config)),this.middlewareStack.use(Rc(this.config)),this.middlewareStack.use(Fo(this.config)),this.middlewareStack.use(li(this.config)),this.middlewareStack.use(fi(this.config)),this.middlewareStack.use(wi(this.config)),this.middlewareStack.use(xi(this.config,{httpAuthSchemeParametersProvider:Dc,identityProviderConfigProvider:async h=>new qi({"aws.auth#sigv4":h.credentials})})),this.middlewareStack.use(Mi(this.config))}destroy(){super.destroy()}}class L extends Ce{constructor(e){super(e),Object.setPrototypeOf(this,L.prototype)}}class as extends L{constructor(s){super({name:"AccessDeniedException",$fault:"client",...s});A(this,"name","AccessDeniedException");A(this,"$fault","client");Object.setPrototypeOf(this,as.prototype)}}class os extends L{constructor(s){super({name:"InvalidArgumentException",$fault:"client",...s});A(this,"name","InvalidArgumentException");A(this,"$fault","client");Object.setPrototypeOf(this,os.prototype)}}class cs extends L{constructor(s){super({name:"LimitExceededException",$fault:"client",...s});A(this,"name","LimitExceededException");A(this,"$fault","client");Object.setPrototypeOf(this,cs.prototype)}}class us extends L{constructor(s){super({name:"ResourceInUseException",$fault:"client",...s});A(this,"name","ResourceInUseException");A(this,"$fault","client");Object.setPrototypeOf(this,us.prototype)}}class ls extends L{constructor(s){super({name:"ResourceNotFoundException",$fault:"client",...s});A(this,"name","ResourceNotFoundException");A(this,"$fault","client");Object.setPrototypeOf(this,ls.prototype)}}class ds extends L{constructor(s){super({name:"ExpiredIteratorException",$fault:"client",...s});A(this,"name","ExpiredIteratorException");A(this,"$fault","client");Object.setPrototypeOf(this,ds.prototype)}}class hs extends L{constructor(s){super({name:"ExpiredNextTokenException",$fault:"client",...s});A(this,"name","ExpiredNextTokenException");A(this,"$fault","client");Object.setPrototypeOf(this,hs.prototype)}}class fs extends L{constructor(s){super({name:"KMSAccessDeniedException",$fault:"client",...s});A(this,"name","KMSAccessDeniedException");A(this,"$fault","client");Object.setPrototypeOf(this,fs.prototype)}}class ps extends L{constructor(s){super({name:"KMSDisabledException",$fault:"client",...s});A(this,"name","KMSDisabledException");A(this,"$fault","client");Object.setPrototypeOf(this,ps.prototype)}}class gs extends L{constructor(s){super({name:"KMSInvalidStateException",$fault:"client",...s});A(this,"name","KMSInvalidStateException");A(this,"$fault","client");Object.setPrototypeOf(this,gs.prototype)}}class ms extends L{constructor(s){super({name:"KMSNotFoundException",$fault:"client",...s});A(this,"name","KMSNotFoundException");A(this,"$fault","client");Object.setPrototypeOf(this,ms.prototype)}}class ys extends L{constructor(s){super({name:"KMSOptInRequired",$fault:"client",...s});A(this,"name","KMSOptInRequired");A(this,"$fault","client");Object.setPrototypeOf(this,ys.prototype)}}class ws extends L{constructor(s){super({name:"KMSThrottlingException",$fault:"client",...s});A(this,"name","KMSThrottlingException");A(this,"$fault","client");Object.setPrototypeOf(this,ws.prototype)}}class bs extends L{constructor(s){super({name:"ProvisionedThroughputExceededException",$fault:"client",...s});A(this,"name","ProvisionedThroughputExceededException");A(this,"$fault","client");Object.setPrototypeOf(this,bs.prototype)}}class Ss extends L{constructor(s){super({name:"ValidationException",$fault:"client",...s});A(this,"name","ValidationException");A(this,"$fault","client");Object.setPrototypeOf(this,Ss.prototype)}}var ln;(function(t){t.visit=(e,s)=>e.SubscribeToShardEvent!==void 0?s.SubscribeToShardEvent(e.SubscribeToShardEvent):e.ResourceNotFoundException!==void 0?s.ResourceNotFoundException(e.ResourceNotFoundException):e.ResourceInUseException!==void 0?s.ResourceInUseException(e.ResourceInUseException):e.KMSDisabledException!==void 0?s.KMSDisabledException(e.KMSDisabledException):e.KMSInvalidStateException!==void 0?s.KMSInvalidStateException(e.KMSInvalidStateException):e.KMSAccessDeniedException!==void 0?s.KMSAccessDeniedException(e.KMSAccessDeniedException):e.KMSNotFoundException!==void 0?s.KMSNotFoundException(e.KMSNotFoundException):e.KMSOptInRequired!==void 0?s.KMSOptInRequired(e.KMSOptInRequired):e.KMSThrottlingException!==void 0?s.KMSThrottlingException(e.KMSThrottlingException):e.InternalFailureException!==void 0?s.InternalFailureException(e.InternalFailureException):s._(e.$unknown[0],e.$unknown[1])})(ln||(ln={}));const sl=async(t,e)=>{const s=Cl("PutRecords");let n;return n=JSON.stringify(Sl(t,e)),Al(e,s,"/",void 0,n)},nl=async(t,e)=>{if(t.statusCode>=300)return rl(t,e);const s=await Jn(t.body,e);let n={};return n=F(s),{$metadata:j(t),...n}},rl=async(t,e)=>{const s={...t,body:await So(t.body,e)},n=vo(t,s.body);switch(n){case"AccessDeniedException":case"com.amazonaws.kinesis#AccessDeniedException":throw await il(s);case"InvalidArgumentException":case"com.amazonaws.kinesis#InvalidArgumentException":throw await cl(s);case"LimitExceededException":case"com.amazonaws.kinesis#LimitExceededException":throw await gl(s);case"ResourceInUseException":case"com.amazonaws.kinesis#ResourceInUseException":throw await yl(s);case"ResourceNotFoundException":case"com.amazonaws.kinesis#ResourceNotFoundException":throw await wl(s);case"ExpiredIteratorException":case"com.amazonaws.kinesis#ExpiredIteratorException":throw await al(s);case"KMSAccessDeniedException":case"com.amazonaws.kinesis#KMSAccessDeniedException":throw await ul(s);case"KMSDisabledException":case"com.amazonaws.kinesis#KMSDisabledException":throw await ll(s);case"KMSInvalidStateException":case"com.amazonaws.kinesis#KMSInvalidStateException":throw await dl(s);case"KMSNotFoundException":case"com.amazonaws.kinesis#KMSNotFoundException":throw await hl(s);case"KMSOptInRequired":case"com.amazonaws.kinesis#KMSOptInRequired":throw await fl(s);case"KMSThrottlingException":case"com.amazonaws.kinesis#KMSThrottlingException":throw await pl(s);case"ProvisionedThroughputExceededException":case"com.amazonaws.kinesis#ProvisionedThroughputExceededException":throw await ml(s);case"ExpiredNextTokenException":case"com.amazonaws.kinesis#ExpiredNextTokenException":throw await ol(s);case"ValidationException":case"com.amazonaws.kinesis#ValidationException":throw await bl(s);default:const r=s.body;return El({output:t,parsedBody:r,errorCode:n})}},il=async(t,e)=>{const s=t.body,n=F(s),r=new as({$metadata:j(t),...n});return $(r,s)},al=async(t,e)=>{const s=t.body,n=F(s),r=new ds({$metadata:j(t),...n});return $(r,s)},ol=async(t,e)=>{const s=t.body,n=F(s),r=new hs({$metadata:j(t),...n});return $(r,s)},cl=async(t,e)=>{const s=t.body,n=F(s),r=new os({$metadata:j(t),...n});return $(r,s)},ul=async(t,e)=>{const s=t.body,n=F(s),r=new fs({$metadata:j(t),...n});return $(r,s)},ll=async(t,e)=>{const s=t.body,n=F(s),r=new ps({$metadata:j(t),...n});return $(r,s)},dl=async(t,e)=>{const s=t.body,n=F(s),r=new gs({$metadata:j(t),...n});return $(r,s)},hl=async(t,e)=>{const s=t.body,n=F(s),r=new ms({$metadata:j(t),...n});return $(r,s)},fl=async(t,e)=>{const s=t.body,n=F(s),r=new ys({$metadata:j(t),...n});return $(r,s)},pl=async(t,e)=>{const s=t.body,n=F(s),r=new ws({$metadata:j(t),...n});return $(r,s)},gl=async(t,e)=>{const s=t.body,n=F(s),r=new cs({$metadata:j(t),...n});return $(r,s)},ml=async(t,e)=>{const s=t.body,n=F(s),r=new bs({$metadata:j(t),...n});return $(r,s)},yl=async(t,e)=>{const s=t.body,n=F(s),r=new us({$metadata:j(t),...n});return $(r,s)},wl=async(t,e)=>{const s=t.body,n=F(s),r=new ls({$metadata:j(t),...n});return $(r,s)},bl=async(t,e)=>{const s=t.body,n=F(s),r=new Ss({$metadata:j(t),...n});return $(r,s)},Sl=(t,e)=>Zn(t,{Records:s=>xl(s,e),StreamARN:[],StreamName:[]}),vl=(t,e)=>Zn(t,{Data:e.base64Encoder,ExplicitHashKey:[],PartitionKey:[]}),xl=(t,e)=>t.filter(s=>s!=null).map(s=>vl(s,e)),j=t=>({httpStatusCode:t.statusCode,requestId:t.headers["x-amzn-requestid"]??t.headers["x-amzn-request-id"]??t.headers["x-amz-request-id"],extendedRequestId:t.headers["x-amz-id-2"],cfId:t.headers["x-amz-cf-id"]}),El=ao(L),Al=async(t,e,s,n,r)=>{const{hostname:i,protocol:a="https",port:o,path:c}=await t.endpoint(),u={protocol:a,hostname:i,port:o,method:"POST",path:c.endsWith("/")?c.slice(0,-1)+s:c+s,headers:e};return r!==void 0&&(u.body=r),new K(u)};function Cl(t){return{"content-type":"application/x-amz-json-1.1","x-amz-target":`Kinesis_20131202.${t}`}}class Rl extends Xn.classBuilder().ep({...Pc,OperationType:{type:"staticContextParams",value:"data"},StreamARN:{type:"contextParams",name:"StreamARN"}}).m(function(e,s,n,r){return[Ri(n,this.serialize,this.deserialize),Xo(n,e.getEndpointParameterInstructions())]}).s("Kinesis_20131202","PutRecords",{}).n("KinesisClient","PutRecordsCommand").f(void 0,void 0).ser(sl).de(nl).build(){}const Ne=Yt(navigator.userAgent);class _l extends Xt{constructor(s,n,r,i,a,o,c,u,l,d,f){super(s);A(this,"kinesisClient");this.analyticsStorage=n,this.analyticsService=r,this.globalStateService=i,this.userService=a,this.i18nService=o,this.fetchService=c,this.appService=u,this.connectionService=l,this.notificationService=d,this.edpMessageService=f,this.kinesisClient=new tl({region:ei,credentials:{accessKeyId:ni,secretAccessKey:ri}}),this.analyticsService.use(this)}get eventNumber(){return this.analyticsStorage.state.eventSequenceNumber}async boot(){await this.analyticsStorage.sync(),this.analyticsStorage.state.sessionData||(await this.incrementSessionSequenceNumber(),await this.generateSessionData()),this.analyticsStorage.state.initialIpAddress||this.setInitialIpAddress().catch(()=>{}),this.bootResolve()}async send(s){if(await this.bootPromise,!this.available)return;await this.incrementEventSequenceNumber();const n={...s,data:{...s.data,event_id:this.eventNumber,event_time_utc:Date.now()}},r=this.formatData(n);try{await this.kinesisClient.send(r)}catch{}}formatData(s){const n=this.getUserProperties(),r=this.getGeneralProperties(),i={...n,...r,...s.data,event_name:s.name};this.edpMessageService.notifyEdp({type:"edp-kinesis-analytic-event",success:!0,data:i});const o={Data:new TextEncoder().encode(JSON.stringify(i)),PartitionKey:ti};return new Rl({Records:[o],StreamName:si})}getUserProperties(){const s=this.connectionService.useAutoConnect?"on":"off",n=this.appService.isBlockAds?"on":"off",r=this.notificationService.permition==="allowed"?"on":"off",i={user_properties__autoconnect_app:s,user_properties__adblock:n,user_properties__webrtc:"default",user_properties__stop_trackers:"default",user_properties__block_traking_socials:"default",user_properties__block_push_cookies:"default",user_properties__malware_evader:"default",user_properties__remove_utm_parameters:"default",user_properties__remove_fbclid:"default",user_properties__remove_gclid:"default",user_properties__location_warp:"default",user_properties__time_warp:"default",user_properties__language_warp:"default",user_properties__plan:"default",user_properties__desktop_notifications:r,user_properties__smart_location:"default",user_properties__exclude_websites:"default",user_properties__custom_proxy:"default",user_properties__mask_user_agent:"default",user_properties__debug_logging:"default"};return this.userService.subscription&&(i.user_properties__plan=this.userService.subscription.name),i}getGeneralProperties(){var l,d,f,h,g,w,m,S;const s=B.runtime.getManifest(),n=((l=new Date().toString().match(/([-+][0-9]+)\s/))==null?void 0:l[1])??"",{timeZone:r}=Intl.DateTimeFormat().resolvedOptions(),i=this.analyticsStorage.state.sessionSequenceNumber===1?1:0,a=Ne.browser.name??"Chrome",o=Ne.browser.version??"0.0.0",c=()=>this.appService.colorTheme==="dark"?"dark":this.appService.colorTheme==="light"?"light":"default";return{user_id:((d=this.userService.user)==null?void 0:d.id)??"",device_id:this.globalStateService.udid.value,time_offset:n,time_zone:r,session_number:this.analyticsStorage.state.sessionSequenceNumber,session_id:((f=this.analyticsStorage.state.sessionData)==null?void 0:f.id)??"",session_started:((h=this.analyticsStorage.state.sessionData)==null?void 0:h.startedAt)??"",is_first_session:i,app_version:s.version,start_app_version:this.analyticsStorage.state.startAppVersion,platform:"extension",device_category:Ne.device.type??"desktop",os_name:Ne.os.name??"",os_version:Ne.os.version??"",screen_width:String(this.globalStateService.deviceScreen.width),screen_height:String(this.globalStateService.deviceScreen.height),browser_group:a,browser_name:`${a} ${o}`,browser_user_agent:navigator.userAgent,app_language:this.i18nService.activeLocale,ip_address:this.analyticsStorage.state.initialIpAddress??"",country:((g=this.appService.geolocation)==null?void 0:g.country)??"",region:((w=this.appService.geolocation)==null?void 0:w.region)??"",event_source:"extension",user_properties__exp_id:((m=this.analyticsService.experiment)==null?void 0:m.slug)??"",user_properties__exp_var:((S=this.analyticsService.experiment)==null?void 0:S.group.toString())??"",user_properties__install_date:this.globalStateService.installedAt,user_properties__theme:c()}}async incrementEventSequenceNumber(){await this.analyticsStorage.setItems({eventSequenceNumber:this.eventNumber+1})}async incrementSessionSequenceNumber(){const s=this.analyticsStorage.state.sessionSequenceNumber;await this.analyticsStorage.setItems({sessionSequenceNumber:s+1})}async generateSessionData(){await this.analyticsStorage.setItems({sessionData:{id:crypto.randomUUID(),startedAt:Date.now()}})}async setInitialIpAddress(){const s=await this.fetchService.request({method:"GET",url:Xr});if(s.success)try{const n=s.data.trim().split(/\n/).map(i=>i.split("=")),r=Object.fromEntries(n);await this.analyticsStorage.setItems({initialIpAddress:r.ip})}catch{}}}const Dl=new Qt("aws-kinesis",Jr,mt),kl=new _l("aws-kinesis",Dl,ie,se,fe,Ie,yt,Me,Pe,ve,wt),Tl="349c341094927d0c67a38a15e4cfbfdc",Ml="https://api2.amplitude.com/2/httpapi";class Il extends Xt{constructor(e,s,n,r,i,a,o,c,u){super(e),this.analyticsService=s,this.globalStateService=n,this.fetchService=r,this.userService=i,this.i18nService=a,this.appService=o,this.connectionService=c,this.notificationService=u,this.analyticsService.use(this)}async boot(){await Promise.resolve(this),this.bootResolve()}async send(e){if(await this.bootPromise,!this.available||!this.userService.user)return;const s=this.formatData(e);await this.fetchService.request({url:Ml,method:"POST",body:{api_key:Tl,events:[s]}})}formatData(e){const s=B.runtime.getManifest(),n=this.getUserProperties();return{app_version:s.version,event_type:e.name,event_properties:{...e.data},user_id:this.globalStateService.udid.value,user_properties:{...n}}}getUserProperties(){const e=this.userService.user?"authorized":"non-authorized",s=this.notificationService.permition==="allowed"?"on":"off",n=()=>this.appService.colorTheme==="dark"?"on":this.appService.colorTheme==="light"?"off":"default",r=this.connectionService.useAutoConnect?"on":"off",i={user_type:this.userService.userType,user_auth_status:e,desktop_notifications:s,dark_mode:n(),block_webrtc_detection:"default",adblock:"default",stop_trackers:"default",block_tracking_social:"default",block_push_use_coockies:"default",malware_evader:"default",remove_utm_parameters:"default",remove_fbclid_parameters:"default",remove_gclid_parameters:"default",location_warp:"default",time_warp:"default",language_warp:"default",auto_connect:r,smart_location:"default",exclude_websites:"default",custom_proxy:"default",mask_user_agent:"default",debug_logging:"default",language:this.i18nService.activeLocale,plan:"free"};return this.userService.subscription&&(i.plan=this.userService.subscription.name),i}}const Pl=new Il("amplitude",ie,se,yt,fe,Ie,Me,Pe,ve),Bl=24*60*60*1e3,dn="https://safe.veepn.com",hn={auth:"/v2/auth/",action:"/v2/action/",config:"/v2/config/"},fn="MKPPjhvg7dNqSvzcy9jSDk75DhiRNJKF",Ol=R.object({slug:R.enum(["gd_share_state","email_input_blur","password_input_blur","fb_account_hijackers","gm_account_hijackers"]),type:R.enum(["dom-analysis"]),domain:R.string(),selector:R.string(),sensitive:R.boolean(),trigger:R.object({type:R.enum(["attribute","listener","content"]),value:R.string()}),matcher:R.object({type:R.enum(["regex"]),value:R.string()}),extractor:R.union([R.object({type:R.enum(["pwned"])}),R.object({type:R.enum(["url"]),value:R.string()})]).optional()}),Nl=R.object({auth:R.object({status:R.boolean()}).optional().describe(ue.persist),rules:R.object({data:R.array(Ol),updatedAt:R.number()}).optional().describe(ue.persist)}).default({}),Fl=new Kt(Nl);class ht extends xn{constructor(e,s,n,r){super(),this.guardAlertStorage=e,this.fetchService=s,this.globalStateService=n,this.abTestsService=r}get authenticated(){var n;const e=this.abTestsService.getExperimentStatus(Ut.guardAlert);return!!((n=this.guardAlertStorage.state.auth)!=null&&n.status)&&e.active}get needUpdateRules(){if(!this.guardAlertStorage.state.rules)return!0;const e=this.guardAlertStorage.state.rules.updatedAt+Bl;return this.authenticated&&e<Date.now()}async boot(){await this.guardAlertStorage.sync(),this.abTestsService.getExperimentStatus(Ut.guardAlert).active&&(this.authenticated?this.needUpdateRules&&this.updateRules().catch(()=>{}):this.authenticate().then(()=>{if(this.needUpdateRules)return this.updateRules()}).catch(()=>{})),this.bootResolve(),await this.bootPromise}async fetch(e){const s={...e,url:dn+hn[e.url]};return await this.fetchService.request(s)}async authenticate(){(await this.fetch({url:"auth",method:"POST",body:{udid:this.globalStateService.udid.value}})).success&&await this.guardAlertStorage.setItems({auth:{status:!0}})}async updateRules(){const e=await this.fetch({url:"config",method:"GET"}),s=e.success?e.data.items:[];await this.guardAlertStorage.setItems({rules:{data:s,updatedAt:Date.now()}})}async sendAction(e){try{const s={udid:this.globalStateService.udid.value,items:[e]},n=await ht.encryptJsonObject(s,fn),r=await fetch(dn+hn.action,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:n});if(!r.ok||!r.body||r.status!==200)throw new Error("Fetch error");const i=await r.blob(),a=await new Response(i).arrayBuffer(),o=new Uint8Array(a);return{success:!0,data:await ht.decryptJsonObject(o,fn)}}catch{return{success:!1,errors:[]}}}getRulesByDomain(e){var r;const s=new URL(e).hostname;return((r=this.guardAlertStorage.state.rules)==null?void 0:r.data.filter(i=>new RegExp(i.domain,"i").test(s)))??[]}getRuleBySlug(e){var n;return(n=this.guardAlertStorage.state.rules)==null?void 0:n.data.find(r=>r.slug===e)}static async encryptJsonObject(e,s){const n=JSON.stringify(e),r=new TextEncoder().encode(n),i=new TextEncoder().encode(s),a=await crypto.subtle.digest("SHA-256",i),o=crypto.getRandomValues(new Uint8Array(16)),c=await crypto.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await crypto.subtle.encrypt({name:"AES-CBC",iv:o},c,r),l=new Uint8Array(u),d=new Uint8Array(o.length+l.length);return d.set(o),d.set(l,o.length),d}static async decryptJsonObject(e,s){const n=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",n),i=e.slice(0,16),a=e.slice(16),o=await crypto.subtle.importKey("raw",r,"AES-CBC",!1,["decrypt"]),c=await crypto.subtle.decrypt({name:"AES-CBC",iv:i},o,a),u=new TextDecoder().decode(c);return JSON.parse(u)}}const Ll=new Qt("guard-alert",Fl,mt),gr=new ht(Ll,yt,se,Ke);class ft{constructor(){}static refreshSelf(){B.runtime.reload()}async ping(){return await Promise.resolve(this),{success:!0,data:{success:!0}}}async getLocalStore(){return await Promise.resolve(this),{success:!0,data:await B.storage.local.get()}}async setLocalStore(e){return await Promise.resolve(this),await B.storage.local.set(e),ft.refreshSelf(),{success:!0,data:{success:!0}}}async getSessionStore(){return await Promise.resolve(this),{success:!0,data:await B.storage.session.get()}}async setSessionStore(e){return await Promise.resolve(this),await B.storage.session.set(e),ft.refreshSelf(),{success:!0,data:{success:!0}}}}class Ul{constructor(e,s){this.edpMessageService=e,this.edpController=s}init(){this.edpMessageService.subscribe({"edp-ping":this.ping.bind(this),"edp-get-local-store":this.getLocalStore.bind(this),"edp-set-local-store":this.setLocalStore.bind(this),"edp-get-session-store":this.getSessionStore.bind(this),"edp-set-session-store":this.setSessionStore.bind(this)})}async ping(){return{...await this.edpController.ping(),type:"edp-ping"}}async getLocalStore(){return{...await this.edpController.getLocalStore(),type:"edp-get-local-store"}}async setLocalStore(e){return{...await this.edpController.setLocalStore(e),type:"edp-set-local-store"}}async getSessionStore(){return{...await this.edpController.getSessionStore(),type:"edp-get-session-store"}}async setSessionStore(e){return{...await this.edpController.setSessionStore(e),type:"edp-set-session-store"}}}const $l=new ft,jl=new Ul(wt,$l);class zl{constructor(e){this.abTestsService=e}async getTestStatus(e){return await Promise.resolve(),{success:!0,data:this.abTestsService.getExperimentStatus(e)}}}class Hl{constructor(e,s){this.messageService=e,this.abTestsController=s}init(){this.messageService.subscribe({"get-test-status":this.getTestStatus.bind(this)})}async getTestStatus(e){return{...await this.abTestsController.getTestStatus(e),type:"get-test-status"}}}const ql=new zl(Ke),Gl=new Hl(Ve,ql),Gt=(t,e)=>t.push.apply(t,e),Te=t=>t.sort((e,s)=>e.i-s.i||e.j-s.j),pn=t=>{const e={};let s=1;return t.forEach(n=>{e[n]=s,s+=1}),e};var Wl={4:[[1,2],[2,3]],5:[[1,3],[2,3],[2,4]],6:[[1,2],[2,4],[4,5]],7:[[1,3],[2,3],[4,5],[4,6]],8:[[2,4],[4,6]]};const gn=2050,mn=1e3,Vl=Wl,Kl=10,Yl=1e4,mr=10,yr=50,wr=20,br=/^[A-Z\xbf-\xdf][^A-Z\xbf-\xdf]+$/,Xl=/^[^A-Z\xbf-\xdf]+[A-Z\xbf-\xdf]$/,Ql=/^[A-Z\xbf-\xdf]+$/,Sr=/^[^a-z\xdf-\xff]+$/,Zl=/^[a-z\xdf-\xff]+$/,Jl=/^[^A-Z\xbf-\xdf]+$/,ed=/[a-z\xdf-\xff]/,td=/[A-Z\xbf-\xdf]/,sd=/[^A-Za-z\xbf-\xdf]/gi,nd=/^\d+$/,vs=new Date().getFullYear(),rd={recentYear:/19\d\d|200\d|201\d|202\d/g},vr=[" ",",",";",":","|","/","\\","_",".","-"],id=vr.length;class ad{match({password:e}){const s=[...this.getMatchesWithoutSeparator(e),...this.getMatchesWithSeparator(e)],n=this.filterNoise(s);return Te(n)}getMatchesWithSeparator(e){const s=[],n=/^(\d{1,4})([\s/\\_.-])(\d{1,2})\2(\d{1,4})$/;for(let r=0;r<=Math.abs(e.length-6);r+=1)for(let i=r+5;i<=r+9&&!(i>=e.length);i+=1){const a=e.slice(r,+i+1||9e9),o=n.exec(a);if(o!=null){const c=this.mapIntegersToDayMonthYear([parseInt(o[1],10),parseInt(o[3],10),parseInt(o[4],10)]);c!=null&&s.push({pattern:"date",token:a,i:r,j:i,separator:o[2],year:c.year,month:c.month,day:c.day})}}return s}getMatchesWithoutSeparator(e){const s=[],n=/^\d{4,8}$/,r=i=>Math.abs(i.year-vs);for(let i=0;i<=Math.abs(e.length-4);i+=1)for(let a=i+3;a<=i+7&&!(a>=e.length);a+=1){const o=e.slice(i,+a+1||9e9);if(n.exec(o)){const c=[],u=o.length;if(Vl[u].forEach(([d,f])=>{const h=this.mapIntegersToDayMonthYear([parseInt(o.slice(0,d),10),parseInt(o.slice(d,f),10),parseInt(o.slice(f),10)]);h!=null&&c.push(h)}),c.length>0){let d=c[0],f=r(c[0]);c.slice(1).forEach(h=>{const g=r(h);g<f&&(d=h,f=g)}),s.push({pattern:"date",token:o,i,j:a,separator:"",year:d.year,month:d.month,day:d.day})}}}return s}filterNoise(e){return e.filter(s=>{let n=!1;const r=e.length;for(let i=0;i<r;i+=1){const a=e[i];if(s!==a&&a.i<=s.i&&a.j>=s.j){n=!0;break}}return!n})}mapIntegersToDayMonthYear(e){if(e[1]>31||e[1]<=0)return null;let s=0,n=0,r=0;for(let i=0,a=e.length;i<a;i+=1){const o=e[i];if(o>99&&o<mn||o>gn)return null;o>31&&(n+=1),o>12&&(s+=1),o<=0&&(r+=1)}return n>=2||s===3||r>=2?null:this.getDayMonth(e)}getDayMonth(e){const s=[[e[2],e.slice(0,2)],[e[0],e.slice(1,3)]],n=s.length;for(let r=0;r<n;r+=1){const[i,a]=s[r];if(mn<=i&&i<=gn){const o=this.mapIntegersToDayMonth(a);return o!=null?{year:i,month:o.month,day:o.day}:null}}for(let r=0;r<n;r+=1){const[i,a]=s[r],o=this.mapIntegersToDayMonth(a);if(o!=null)return{year:this.twoToFourDigitYear(i),month:o.month,day:o.day}}return null}mapIntegersToDayMonth(e){const s=[e,e.slice().reverse()];for(let n=0;n<s.length;n+=1){const r=s[n],i=r[0],a=r[1];if(i>=1&&i<=31&&a>=1&&a<=12)return{day:i,month:a}}return null}twoToFourDigitYear(e){return e>99?e:e>50?e+1900:e+2e3}}const re=new Uint32Array(65536),od=(t,e)=>{const s=t.length,n=e.length,r=1<<s-1;let i=-1,a=0,o=s,c=s;for(;c--;)re[t.charCodeAt(c)]|=1<<c;for(c=0;c<n;c++){let u=re[e.charCodeAt(c)];const l=u|a;u|=(u&i)+i^i,a|=~(u|i),i&=u,a&r&&o++,i&r&&o--,a=a<<1|1,i=i<<1|~(l|a),a&=l}for(c=s;c--;)re[t.charCodeAt(c)]=0;return o},cd=(t,e)=>{const s=e.length,n=t.length,r=[],i=[],a=Math.ceil(s/32),o=Math.ceil(n/32);for(let g=0;g<a;g++)i[g]=-1,r[g]=0;let c=0;for(;c<o-1;c++){let g=0,w=-1;const m=c*32,S=Math.min(32,n)+m;for(let y=m;y<S;y++)re[t.charCodeAt(y)]|=1<<y;for(let y=0;y<s;y++){const k=re[e.charCodeAt(y)],C=i[y/32|0]>>>y&1,O=r[y/32|0]>>>y&1,G=k|g,Ee=((k|O)&w)+w^w|k|O;let Oe=g|~(Ee|w),Ye=w&Ee;Oe>>>31^C&&(i[y/32|0]^=1<<y),Ye>>>31^O&&(r[y/32|0]^=1<<y),Oe=Oe<<1|C,Ye=Ye<<1|O,w=Ye|~(G|Oe),g=Oe&G}for(let y=m;y<S;y++)re[t.charCodeAt(y)]=0}let u=0,l=-1;const d=c*32,f=Math.min(32,n-d)+d;for(let g=d;g<f;g++)re[t.charCodeAt(g)]|=1<<g;let h=n;for(let g=0;g<s;g++){const w=re[e.charCodeAt(g)],m=i[g/32|0]>>>g&1,S=r[g/32|0]>>>g&1,y=w|u,k=((w|S)&l)+l^l|w|S;let C=u|~(k|l),O=l&k;h+=C>>>n-1&1,h-=O>>>n-1&1,C>>>31^m&&(i[g/32|0]^=1<<g),O>>>31^S&&(r[g/32|0]^=1<<g),C=C<<1|m,O=O<<1|S,l=O|~(y|C),u=C&y}for(let g=d;g<f;g++)re[t.charCodeAt(g)]=0;return h},ud=(t,e)=>{if(t.length<e.length){const s=e;e=t,t=s}return e.length===0?t.length:t.length<=32?od(t,e):cd(t,e)},ld=(t,e,s)=>{const n=t.length<=e.length,r=t.length<=s;return n||r?Math.ceil(t.length/4):s},dd=(t,e,s)=>{let n=0;const r=Object.keys(e).find(i=>{const a=ld(t,i,s);if(Math.abs(t.length-i.length)>a)return!1;const o=ud(t,i),c=o<=a;return c&&(n=o),c});return r?{levenshteinDistance:n,levenshteinDistanceEntry:r}:{}};var yn={a:["4","@"],b:["8"],c:["(","{","[","<"],d:["6","|)"],e:["3"],f:["#"],g:["6","9","&"],h:["#","|-|"],i:["1","!","|"],k:["<","|<"],l:["!","1","|","7"],m:["^^","nn","2n","/\\\\/\\\\"],n:["//"],o:["0","()"],q:["9"],u:["|_|"],s:["$","5"],t:["+","7"],v:["<",">","/"],w:["^/","uu","vv","2u","2v","\\\\/\\\\/"],x:["%","><"],z:["2"]},Ft={warnings:{straightRow:"straightRow",keyPattern:"keyPattern",simpleRepeat:"simpleRepeat",extendedRepeat:"extendedRepeat",sequences:"sequences",recentYears:"recentYears",dates:"dates",topTen:"topTen",topHundred:"topHundred",common:"common",similarToCommon:"similarToCommon",wordByItself:"wordByItself",namesByThemselves:"namesByThemselves",commonNames:"commonNames",userInputs:"userInputs",pwned:"pwned"},suggestions:{l33t:"l33t",reverseWords:"reverseWords",allUppercase:"allUppercase",capitalization:"capitalization",dates:"dates",recentYears:"recentYears",associatedYears:"associatedYears",sequences:"sequences",repeated:"repeated",longerKeyboardPattern:"longerKeyboardPattern",anotherWord:"anotherWord",useWords:"useWords",noNeed:"noNeed",pwned:"pwned"},timeEstimation:{ltSecond:"ltSecond",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",month:"month",months:"months",year:"year",years:"years",centuries:"centuries"}};class We{constructor(e=[]){this.parents=e,this.children=new Map}addSub(e,...s){const n=e.charAt(0);this.children.has(n)||this.children.set(n,new We([...this.parents,n]));let r=this.children.get(n);for(let i=1;i<e.length;i+=1){const a=e.charAt(i);r.hasChild(a)||r.addChild(a),r=r.getChild(a)}return r.subs=(r.subs||[]).concat(s),this}getChild(e){return this.children.get(e)}isTerminal(){return!!this.subs}addChild(e){this.hasChild(e)||this.children.set(e,new We([...this.parents,e]))}hasChild(e){return this.children.has(e)}}var wn=(t,e)=>(Object.entries(t).forEach(([s,n])=>{n.forEach(r=>{e.addSub(r,s)})}),e);class hd{constructor(){this.matchers={},this.l33tTable=yn,this.trieNodeRoot=wn(yn,new We),this.dictionary={userInputs:[]},this.rankedDictionaries={},this.rankedDictionariesMaxWordSize={},this.translations=Ft,this.graphs={},this.useLevenshteinDistance=!1,this.levenshteinThreshold=2,this.l33tMaxSubstitutions=100,this.maxLength=256,this.setRankedDictionaries()}setOptions(e={}){e.l33tTable&&(this.l33tTable=e.l33tTable,this.trieNodeRoot=wn(e.l33tTable,new We)),e.dictionary&&(this.dictionary=e.dictionary,this.setRankedDictionaries()),e.translations&&this.setTranslations(e.translations),e.graphs&&(this.graphs=e.graphs),e.useLevenshteinDistance!==void 0&&(this.useLevenshteinDistance=e.useLevenshteinDistance),e.levenshteinThreshold!==void 0&&(this.levenshteinThreshold=e.levenshteinThreshold),e.l33tMaxSubstitutions!==void 0&&(this.l33tMaxSubstitutions=e.l33tMaxSubstitutions),e.maxLength!==void 0&&(this.maxLength=e.maxLength)}setTranslations(e){if(this.checkCustomTranslations(e))this.translations=e;else throw new Error("Invalid translations object fallback to keys")}checkCustomTranslations(e){let s=!0;return Object.keys(Ft).forEach(n=>{if(n in e){const r=n;Object.keys(Ft[r]).forEach(i=>{i in e[r]||(s=!1)})}else s=!1}),s}setRankedDictionaries(){const e={},s={};Object.keys(this.dictionary).forEach(n=>{e[n]=pn(this.dictionary[n]),s[n]=this.getRankedDictionariesMaxWordSize(this.dictionary[n])}),this.rankedDictionaries=e,this.rankedDictionariesMaxWordSize=s}getRankedDictionariesMaxWordSize(e){const s=e.map(n=>typeof n!="string"?n.toString().length:n.length);return s.length===0?0:s.reduce((n,r)=>Math.max(n,r),-1/0)}buildSanitizedRankedDictionary(e){const s=[];return e.forEach(n=>{const r=typeof n;(r==="string"||r==="number"||r==="boolean")&&s.push(n.toString().toLowerCase())}),pn(s)}extendUserInputsDictionary(e){this.dictionary.userInputs||(this.dictionary.userInputs=[]);const s=[...this.dictionary.userInputs,...e];this.rankedDictionaries.userInputs=this.buildSanitizedRankedDictionary(s),this.rankedDictionariesMaxWordSize.userInputs=this.getRankedDictionariesMaxWordSize(s)}addMatcher(e,s){this.matchers[e]?console.info(`Matcher ${e} already exists`):this.matchers[e]=s}}const v=new hd;class fd{constructor(e){this.defaultMatch=e}match({password:e}){const s=e.split("").reverse().join("");return this.defaultMatch({password:s}).map(n=>({...n,token:n.token.split("").reverse().join(""),reversed:!0,i:e.length-1-n.j,j:e.length-1-n.i}))}}class pd{constructor({substr:e,limit:s,trieRoot:n}){this.buffer=[],this.finalPasswords=[],this.substr=e,this.limit=s,this.trieRoot=n}getAllPossibleSubsAtIndex(e){const s=[];let n=this.trieRoot;for(let r=e;r<this.substr.length;r+=1){const i=this.substr.charAt(r);if(n=n.getChild(i),!n)break;s.push(n)}return s}helper({onlyFullSub:e,isFullSub:s,index:n,subIndex:r,changes:i,lastSubLetter:a,consecutiveSubCount:o}){if(this.finalPasswords.length>=this.limit)return;if(n===this.substr.length){e===s&&this.finalPasswords.push({password:this.buffer.join(""),changes:i});return}const c=[...this.getAllPossibleSubsAtIndex(n)];let u=!1;for(let l=n+c.length-1;l>=n;l-=1){const d=c[l-n];if(d.isTerminal()){if(a===d.parents.join("")&&o>=3)continue;u=!0;const f=d.subs;for(const h of f){this.buffer.push(h);const g=i.concat({i:r,letter:h,substitution:d.parents.join("")});if(this.helper({onlyFullSub:e,isFullSub:s,index:l+1,subIndex:r+h.length,changes:g,lastSubLetter:d.parents.join(""),consecutiveSubCount:a===d.parents.join("")?o+1:1}),this.buffer.pop(),this.finalPasswords.length>=this.limit)return}}}if(!e||!u){const l=this.substr.charAt(n);this.buffer.push(l),this.helper({onlyFullSub:e,isFullSub:s&&!u,index:n+1,subIndex:r+1,changes:i,lastSubLetter:a,consecutiveSubCount:o}),this.buffer.pop()}}getAll(){return this.helper({onlyFullSub:!0,isFullSub:!0,index:0,subIndex:0,changes:[],lastSubLetter:void 0,consecutiveSubCount:0}),this.helper({onlyFullSub:!1,isFullSub:!0,index:0,subIndex:0,changes:[],lastSubLetter:void 0,consecutiveSubCount:0}),this.finalPasswords}}const gd=(t,e,s)=>new pd({substr:t,limit:e,trieRoot:s}).getAll(),md=(t,e,s)=>{const r=t.changes.filter(u=>u.i<e).reduce((u,l)=>u-l.letter.length+l.substitution.length,e),i=t.changes.filter(u=>u.i>=e&&u.i<=s),a=i.reduce((u,l)=>u-l.letter.length+l.substitution.length,s-e+r),o=[],c=[];return i.forEach(u=>{o.findIndex(d=>d.letter===u.letter&&d.substitution===u.substitution)<0&&(o.push({letter:u.letter,substitution:u.substitution}),c.push(`${u.substitution} -> ${u.letter}`))}),{i:r,j:a,subs:o,subDisplay:c.join(", ")}};class yd{constructor(e){this.defaultMatch=e}isAlreadyIncluded(e,s){return e.some(n=>Object.entries(n).every(([r,i])=>r==="subs"||i===s[r]))}match({password:e}){const s=[],n=gd(e,v.l33tMaxSubstitutions,v.trieNodeRoot);let r=!1,i=!0;return n.forEach(a=>{if(r)return;const o=this.defaultMatch({password:a.password,useLevenshtein:i});i=!1,o.forEach(c=>{r||(r=c.i===0&&c.j===e.length-1);const u=md(a,c.i,c.j),l=e.slice(u.i,+u.j+1||9e9),d={...c,l33t:!0,token:l,...u},f=this.isAlreadyIncluded(s,d);l.toLowerCase()!==c.matchedWord&&!f&&s.push(d)})}),s.filter(a=>a.token.length>1)}}class wd{constructor(){this.l33t=new yd(this.defaultMatch),this.reverse=new fd(this.defaultMatch)}match({password:e}){const s=[...this.defaultMatch({password:e}),...this.reverse.match({password:e}),...this.l33t.match({password:e})];return Te(s)}defaultMatch({password:e,useLevenshtein:s=!0}){const n=[],r=e.length,i=e.toLowerCase();return Object.keys(v.rankedDictionaries).forEach(a=>{const o=v.rankedDictionaries[a],c=v.rankedDictionariesMaxWordSize[a],u=Math.min(c,r);for(let l=0;l<r;l+=1){const d=Math.min(l+u,r);for(let f=l;f<d;f+=1){const h=i.slice(l,+f+1||9e9),g=h in o;let w={};const m=l===0&&f===r-1;v.useLevenshteinDistance&&m&&!g&&s&&(w=dd(h,o,v.levenshteinThreshold));const S=Object.keys(w).length!==0;if(g||S){const y=S?w.levenshteinDistanceEntry:h,k=o[y];n.push({pattern:"dictionary",i:l,j:f,token:e.slice(l,+f+1||9e9),matchedWord:h,rank:k,dictionaryName:a,reversed:!1,l33t:!1,...w})}}}}),n}}class bd{match({password:e,regexes:s=rd}){const n=[];return Object.keys(s).forEach(r=>{const i=s[r];i.lastIndex=0;let a;for(;a=i.exec(e);)if(a){const o=a[0];n.push({pattern:"regex",token:o,i:a.index,j:a.index+a[0].length-1,regexName:r,regexMatch:a})}}),Te(n)}}var xe={nCk(t,e){let s=t;if(e>s)return 0;if(e===0)return 1;let n=1;for(let r=1;r<=e;r+=1)n*=s,n/=r,s-=1;return n},log10(t){return t===0?0:Math.log(t)/Math.log(10)},log2(t){return Math.log(t)/Math.log(2)},factorial(t){let e=1;for(let s=2;s<=t;s+=1)e*=s;return e}},Sd=({token:t})=>{let e=Kl**t.length;e===Number.POSITIVE_INFINITY&&(e=Number.MAX_VALUE);let s;return t.length===1?s=mr+1:s=yr+1,Math.max(e,s)},vd=({year:t,separator:e})=>{let n=Math.max(Math.abs(t-vs),wr)*365;return e&&(n*=4),n};const xd=t=>{const e=t.split(""),s=e.filter(a=>a.match(td)).length,n=e.filter(a=>a.match(ed)).length;let r=0;const i=Math.min(s,n);for(let a=1;a<=i;a+=1)r+=xe.nCk(s+n,a);return r};var Ed=t=>{const e=t.replace(sd,"");if(e.match(Jl)||e.toLowerCase()===e)return 1;const s=[br,Xl,Sr],n=s.length;for(let r=0;r<n;r+=1){const i=s[r];if(e.match(i))return 2}return xd(e)};const bn=(t,e)=>{let s=0,n=t.indexOf(e);for(;n>=0;)s+=1,n=t.indexOf(e,n+e.length);return s},Ad=({sub:t,token:e})=>{const s=e.toLowerCase(),n=bn(s,t.substitution),r=bn(s,t.letter);return{subbedCount:n,unsubbedCount:r}};var Cd=({l33t:t,subs:e,token:s})=>{if(!t)return 1;let n=1;return e.forEach(r=>{const{subbedCount:i,unsubbedCount:a}=Ad({sub:r,token:s});if(i===0||a===0)n*=2;else{const o=Math.min(a,i);let c=0;for(let u=1;u<=o;u+=1)c+=xe.nCk(a+i,u);n*=c}}),n},Rd=({rank:t,reversed:e,l33t:s,subs:n,token:r,dictionaryName:i})=>{const a=t,o=Ed(r),c=Cd({l33t:s,subs:n,token:r}),u=e&&2||1;let l;return i==="diceware"?l=6**5/2:l=a*o*c*u,{baseGuesses:a,uppercaseVariations:o,l33tVariations:c,calculation:l}},_d=({regexName:t,regexMatch:e,token:s})=>{const n={alphaLower:26,alphaUpper:26,alpha:52,alphanumeric:62,digits:10,symbols:33};if(t in n)return n[t]**s.length;switch(t){case"recentYear":return Math.max(Math.abs(parseInt(e[0],10)-vs),wr)}return 0},Dd=({baseGuesses:t,repeatCount:e})=>t*e,kd=({token:t,ascending:e})=>{const s=t.charAt(0);let n=0;return["a","A","z","Z","0","1","9"].includes(s)?n=4:s.match(/\d/)?n=10:n=26,e||(n*=2),n*t.length};const Td=t=>{let e=0;return Object.keys(t).forEach(s=>{const n=t[s];e+=n.filter(r=>!!r).length}),e/=Object.entries(t).length,e},Md=({token:t,graph:e,turns:s})=>{const n=Object.keys(v.graphs[e]).length,r=Td(v.graphs[e]);let i=0;const a=t.length;for(let o=2;o<=a;o+=1){const c=Math.min(s,o-1);for(let u=1;u<=c;u+=1)i+=xe.nCk(o-1,u-1)*n*r**u}return i};var Id=({graph:t,token:e,shiftedCount:s,turns:n})=>{let r=Md({token:e,graph:t,turns:n});if(s){const i=e.length-s;if(s===0||i===0)r*=2;else{let a=0;for(let o=1;o<=Math.min(s,i);o+=1)a+=xe.nCk(s+i,o);r*=a}}return Math.round(r)},Pd=()=>id;const Bd=(t,e)=>{let s=1;return t.token.length<e.length&&(t.token.length===1?s=mr:s=yr),s},Sn={bruteforce:Sd,date:vd,dictionary:Rd,regex:_d,repeat:Dd,sequence:kd,spatial:Id,separator:Pd},Od=(t,e)=>Sn[t]?Sn[t](e):v.matchers[t]&&"scoring"in v.matchers[t]?v.matchers[t].scoring(e):0;var Nd=(t,e)=>{const s={};if("guesses"in t&&t.guesses!=null)return t;const n=Bd(t,e),r=Od(t.pattern,t);let i=0;typeof r=="number"?i=r:t.pattern==="dictionary"&&(i=r.calculation,s.baseGuesses=r.baseGuesses,s.uppercaseVariations=r.uppercaseVariations,s.l33tVariations=r.l33tVariations);const a=Math.max(i,n);return{...t,...s,guesses:a,guessesLog10:xe.log10(a)}};const W={password:"",optimal:{},excludeAdditive:!1,separatorRegex:void 0,fillArray(t,e){const s=[];for(let n=0;n<t;n+=1){let r=[];e==="object"&&(r={}),s.push(r)}return s},makeBruteforceMatch(t,e){return{pattern:"bruteforce",token:this.password.slice(t,+e+1||9e9),i:t,j:e}},update(t,e){const s=t.j,n=Nd(t,this.password);let r=n.guesses;e>1&&(r*=this.optimal.pi[n.i-1][e-1]);let i=xe.factorial(e)*r;this.excludeAdditive||(i+=Yl**(e-1));let a=!1;Object.keys(this.optimal.g[s]).forEach(o=>{const c=this.optimal.g[s][o];parseInt(o,10)<=e&&c<=i&&(a=!0)}),a||(this.optimal.g[s][e]=i,this.optimal.m[s][e]=n,this.optimal.pi[s][e]=r)},bruteforceUpdate(t){let e=this.makeBruteforceMatch(0,t);this.update(e,1);for(let s=1;s<=t;s+=1){e=this.makeBruteforceMatch(s,t);const n=this.optimal.m[s-1];Object.keys(n).forEach(r=>{n[r].pattern!=="bruteforce"&&this.update(e,parseInt(r,10)+1)})}},unwind(t){const e=[];let s=t-1,n=0,r=1/0;const i=this.optimal.g[s];for(i&&Object.keys(i).forEach(a=>{const o=i[a];o<r&&(n=parseInt(a,10),r=o)});s>=0;){const a=this.optimal.m[s][n];e.unshift(a),s=a.i-1,n-=1}return e}};var Wt={mostGuessableMatchSequence(t,e,s=!1){W.password=t,W.excludeAdditive=s;const n=t.length;let r=W.fillArray(n,"array");e.forEach(c=>{r[c.j].push(c)}),r=r.map(c=>c.sort((u,l)=>u.i-l.i)),W.optimal={m:W.fillArray(n,"object"),pi:W.fillArray(n,"object"),g:W.fillArray(n,"object")};for(let c=0;c<n;c+=1)r[c].forEach(u=>{u.i>0?Object.keys(W.optimal.m[u.i-1]).forEach(l=>{W.update(u,parseInt(l,10)+1)}):W.update(u,1)}),W.bruteforceUpdate(c);const i=W.unwind(n),a=i.length,o=this.getGuesses(t,a);return{password:t,guesses:o,guessesLog10:xe.log10(o),sequence:i}},getGuesses(t,e){const s=t.length;let n=0;return t.length===0?n=1:n=W.optimal.g[s-1][e],n}};class Fd{match({password:e,omniMatch:s}){const n=[];let r=0;for(;r<e.length;){const a=this.getGreedyMatch(e,r),o=this.getLazyMatch(e,r);if(a==null)break;const{match:c,baseToken:u}=this.setMatchToken(a,o);if(c){const l=c.index+c[0].length-1,d=this.getBaseGuesses(u,s);n.push(this.normalizeMatch(u,l,c,d)),r=l+1}}return n.some(a=>a instanceof Promise)?Promise.all(n):n}normalizeMatch(e,s,n,r){const i={pattern:"repeat",i:n.index,j:s,token:n[0],baseToken:e,baseGuesses:0,repeatCount:n[0].length/e.length};return r instanceof Promise?r.then(a=>({...i,baseGuesses:a})):{...i,baseGuesses:r}}getGreedyMatch(e,s){const n=/(.+)\1+/g;return n.lastIndex=s,n.exec(e)}getLazyMatch(e,s){const n=/(.+?)\1+/g;return n.lastIndex=s,n.exec(e)}setMatchToken(e,s){const n=/^(.+?)\1+$/;let r,i="";if(s&&e[0].length>s[0].length){r=e;const a=n.exec(r[0]);a&&(i=a[1])}else r=s,r&&(i=r[1]);return{match:r,baseToken:i}}getBaseGuesses(e,s){const n=s.match(e);return n instanceof Promise?n.then(i=>Wt.mostGuessableMatchSequence(e,i).guesses):Wt.mostGuessableMatchSequence(e,n).guesses}}class Ld{constructor(){this.MAX_DELTA=5}match({password:e}){const s=[];if(e.length===1)return[];let n=0,r=null;const i=e.length;for(let a=1;a<i;a+=1){const o=e.charCodeAt(a)-e.charCodeAt(a-1);if(r==null&&(r=o),o!==r){const c=a-1;this.update({i:n,j:c,delta:r,password:e,result:s}),n=c,r=o}}return this.update({i:n,j:i-1,delta:r,password:e,result:s}),s}update({i:e,j:s,delta:n,password:r,result:i}){if(s-e>1||Math.abs(n)===1){const a=Math.abs(n);if(a>0&&a<=this.MAX_DELTA){const o=r.slice(e,+s+1||9e9),{sequenceName:c,sequenceSpace:u}=this.getSequence(o);return i.push({pattern:"sequence",i:e,j:s,token:r.slice(e,+s+1||9e9),sequenceName:c,sequenceSpace:u,ascending:n>0})}}return null}getSequence(e){let s="unicode",n=26;return Zl.test(e)?(s="lower",n=26):Ql.test(e)?(s="upper",n=26):nd.test(e)&&(s="digits",n=10),{sequenceName:s,sequenceSpace:n}}}class Ud{constructor(){this.SHIFTED_RX=/[~!@#$%^&*()_+QWERTYUIOP{}|ASDFGHJKL:"ZXCVBNM<>?]/}match({password:e}){const s=[];return Object.keys(v.graphs).forEach(n=>{const r=v.graphs[n];Gt(s,this.helper(e,r,n))}),Te(s)}checkIfShifted(e,s,n){return!e.includes("keypad")&&this.SHIFTED_RX.test(s.charAt(n))?1:0}helper(e,s,n){let r;const i=[];let a=0;const o=e.length;for(;a<o-1;){let c=a+1,u=null,l=0;for(r=this.checkIfShifted(n,e,a);;){const d=e.charAt(c-1),f=s[d]||[];let h=!1,g=-1,w=-1;if(c<o){const m=e.charAt(c),S=f.length;for(let y=0;y<S;y+=1){const k=f[y];if(w+=1,k){const C=k.indexOf(m);if(C!==-1){h=!0,g=w,C===1&&(r+=1),u!==g&&(l+=1,u=g);break}}}}if(h)c+=1;else{c-a>2&&i.push({pattern:"spatial",i:a,j:c-1,token:e.slice(a,c),graph:n,turns:l,shiftedCount:r}),a=c;break}}}return i}}const $d=new RegExp(`[${vr.join("")}]`);class pt{static getMostUsedSeparatorChar(e){const s=[...e.split("").filter(r=>$d.test(r)).reduce((r,i)=>{const a=r.get(i);return a?r.set(i,a+1):r.set(i,1),r},new Map).entries()].sort(([r,i],[a,o])=>o-i);if(!s.length)return;const n=s[0];if(!(n[1]<2))return n[0]}static getSeparatorRegex(e){return new RegExp(`([^${e}
])(${e})(?!${e})`,"g")}match({password:e}){const s=[];if(e.length===0)return s;const n=pt.getMostUsedSeparatorChar(e);if(n===void 0)return s;const r=pt.getSeparatorRegex(n);for(const i of e.matchAll(r)){if(i.index===void 0)continue;const a=i.index+1;s.push({pattern:"separator",token:n,i:a,j:a})}return s}}class jd{constructor(){this.matchers={date:ad,dictionary:wd,regex:bd,repeat:Fd,sequence:Ld,spatial:Ud,separator:pt}}match(e){const s=[],n=[];return[...Object.keys(this.matchers),...Object.keys(v.matchers)].forEach(i=>{if(!this.matchers[i]&&!v.matchers[i])return;const a=this.matchers[i]?this.matchers[i]:v.matchers[i].Matching,c=new a().match({password:e,omniMatch:this});c instanceof Promise?(c.then(u=>{Gt(s,u)}),n.push(c)):Gt(s,c)}),n.length>0?new Promise((i,a)=>{Promise.all(n).then(()=>{i(Te(s))}).catch(o=>{a(o)})}):Te(s)}}const xr=1,Er=xr*60,Ar=Er*60,Cr=Ar*24,Rr=Cr*31,_r=Rr*12,zd=_r*100,Lt={second:xr,minute:Er,hour:Ar,day:Cr,month:Rr,year:_r,century:zd};class Hd{translate(e,s){let n=e;s!==void 0&&s!==1&&(n+="s");const{timeEstimation:r}=v.translations;return r[n].replace("{base}",`${s}`)}estimateAttackTimes(e){const s={onlineThrottling100PerHour:e/.027777777777777776,onlineNoThrottling10PerSecond:e/10,offlineSlowHashing1e4PerSecond:e/1e4,offlineFastHashing1e10PerSecond:e/1e10},n={onlineThrottling100PerHour:"",onlineNoThrottling10PerSecond:"",offlineSlowHashing1e4PerSecond:"",offlineFastHashing1e10PerSecond:""};return Object.keys(s).forEach(r=>{const i=s[r];n[r]=this.displayTime(i)}),{crackTimesSeconds:s,crackTimesDisplay:n,score:this.guessesToScore(e)}}guessesToScore(e){return e<1005?0:e<1000005?1:e<100000005?2:e<1e10+5?3:4}displayTime(e){let s="centuries",n;const r=Object.keys(Lt),i=r.findIndex(a=>e<Lt[a]);return i>-1&&(s=r[i-1],i!==0?n=Math.round(e/Lt[s]):s="ltSecond"),this.translate(s,n)}}var qd=()=>null,Gd=()=>({warning:v.translations.warnings.dates,suggestions:[v.translations.suggestions.dates]});const Wd=(t,e)=>{let s=null;return e&&!t.l33t&&!t.reversed?t.rank<=10?s=v.translations.warnings.topTen:t.rank<=100?s=v.translations.warnings.topHundred:s=v.translations.warnings.common:t.guessesLog10<=4&&(s=v.translations.warnings.similarToCommon),s},Vd=(t,e)=>{let s=null;return e&&(s=v.translations.warnings.wordByItself),s},Kd=(t,e)=>e?v.translations.warnings.namesByThemselves:v.translations.warnings.commonNames,Yd=(t,e)=>{let s=null;const n=t.dictionaryName,r=n==="lastnames"||n.toLowerCase().includes("firstnames");return n==="passwords"?s=Wd(t,e):n.includes("wikipedia")?s=Vd(t,e):r?s=Kd(t,e):n==="userInputs"&&(s=v.translations.warnings.userInputs),s};var Xd=(t,e)=>{const s=Yd(t,e),n=[],r=t.token;return r.match(br)?n.push(v.translations.suggestions.capitalization):r.match(Sr)&&r.toLowerCase()!==r&&n.push(v.translations.suggestions.allUppercase),t.reversed&&t.token.length>=4&&n.push(v.translations.suggestions.reverseWords),t.l33t&&n.push(v.translations.suggestions.l33t),{warning:s,suggestions:n}},Qd=t=>t.regexName==="recentYear"?{warning:v.translations.warnings.recentYears,suggestions:[v.translations.suggestions.recentYears,v.translations.suggestions.associatedYears]}:{warning:null,suggestions:[]},Zd=t=>{let e=v.translations.warnings.extendedRepeat;return t.baseToken.length===1&&(e=v.translations.warnings.simpleRepeat),{warning:e,suggestions:[v.translations.suggestions.repeated]}},Jd=()=>({warning:v.translations.warnings.sequences,suggestions:[v.translations.suggestions.sequences]}),eh=t=>{let e=v.translations.warnings.keyPattern;return t.turns===1&&(e=v.translations.warnings.straightRow),{warning:e,suggestions:[v.translations.suggestions.longerKeyboardPattern]}},th=()=>null;const vn={warning:null,suggestions:[]};class sh{constructor(){this.matchers={bruteforce:qd,date:Gd,dictionary:Xd,regex:Qd,repeat:Zd,sequence:Jd,spatial:eh,separator:th},this.defaultFeedback={warning:null,suggestions:[]},this.setDefaultSuggestions()}setDefaultSuggestions(){this.defaultFeedback.suggestions.push(v.translations.suggestions.useWords,v.translations.suggestions.noNeed)}getFeedback(e,s){if(s.length===0)return this.defaultFeedback;if(e>2)return vn;const n=v.translations.suggestions.anotherWord,r=this.getLongestMatch(s);let i=this.getMatchFeedback(r,s.length===1);return i!=null?i.suggestions.unshift(n):i={warning:null,suggestions:[n]},i}getLongestMatch(e){let s=e[0];return e.slice(1).forEach(r=>{r.token.length>s.token.length&&(s=r)}),s}getMatchFeedback(e,s){return this.matchers[e.pattern]?this.matchers[e.pattern](e,s):v.matchers[e.pattern]&&"feedback"in v.matchers[e.pattern]?v.matchers[e.pattern].feedback(e,s):vn}}const Dr=()=>new Date().getTime(),nh=(t,e,s)=>{const n=new sh,r=new Hd,i=Wt.mostGuessableMatchSequence(e,t),a=Dr()-s,o=r.estimateAttackTimes(i.guesses);return{calcTime:a,...i,...o,feedback:n.getFeedback(o.score,i.sequence)}},rh=(t,e)=>new jd().match(t),ih=async(t,e)=>{const s=t.substring(0,v.maxLength),n=Dr(),r=await rh(s);return nh(r,s,n)},kr=typeof process<"u"&&process.release&&process.release.name==="node",ah=t=>{if(kr){const e=decodeURI(encodeURIComponent(t)),s=new Uint8Array(e.length);for(let n=0;n<e.length;n+=1)s[n]=e.charCodeAt(n);return s}try{return new TextEncoder().encode(t)}catch(e){throw new Error(`No encoder found, ${e}`)}},oh=async t=>{const e=ah(t);let s="";if(kr)s=require("crypto").createHash("sha1").update(t).digest("hex").toUpperCase();else if(crypto){const n=await crypto.subtle.digest("SHA-1",e);s=Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("").toUpperCase()}return s},ch="https://api.pwnedpasswords.com/range/",uh=t=>!1;var lh=async(t,{universalFetch:e,url:s=ch,networkErrorHandler:n=uh})=>{if(!e||t.length<2)return null;const r=(await oh(t)).toUpperCase(),i=r.slice(0,5),a=r.slice(5),o=await e(`${s}${i}`,{method:"GET",headers:{"Add-Padding":"true"}}).catch(l=>n(l));return typeof o=="boolean"?!1:o.status>=400?n(o):(await o.text()).split(`\r
`).find(l=>l.split(":")[0]===a)},dh=(t,{url:e,networkErrorHandler:s})=>class{async match({password:r}){const i=[],a=await lh(r,{universalFetch:t,url:e,networkErrorHandler:s});return a&&i.push({pattern:"pwned",pwnedAmount:parseInt(a.split(":")[1],10),i:0,j:r.length-1,token:r}),i}},hh=()=>1,fh=t=>()=>({warning:t.translations.warnings.pwned,suggestions:[t.translations.suggestions.pwned]});const ph=(t,e,s={})=>({Matching:dh(t,s),feedback:fh(e),scoring:hh}),gh=ph(fetch,v);v.addMatcher("pwned",gh);class Re{constructor(e,s){this.guardAlertService=e,this.userService=s}async getGuardEnableState(){await Promise.resolve();const e=this.guardAlertService.authenticated,s=this.userService.userType==="free";return{success:!0,data:{status:e&&s}}}async getGuardRules(e){await Promise.resolve();const s=this.guardAlertService.getRulesByDomain(e.url);return s.length===0?{success:!1,errors:[]}:{success:!0,data:{rules:s}}}async sendGuardAction(e){const s=this.guardAlertService.getRuleBySlug(e.slug);if(!s)return{success:!1,errors:[]};let n=Re.matchValue(s,e);if(!n)return{success:!1,errors:[]};if(n=await Re.extractValue(s,n),!n)return{success:!1,errors:[]};const r=n.value;s.sensitive&&(n.value=await Re.sha256(n.value));const i=await this.guardAlertService.sendAction(n);return i.success?{success:!0,data:{modal:i.data.modal,data:{value:r}}}:{success:!1,errors:[]}}static matchValue(e,s){var n;if(e.matcher.type==="regex"){const r=new RegExp(e.matcher.value,"i"),i=(n=s.value.match(r))==null?void 0:n[0];if(i!==void 0)return{...s,value:i}}}static async extractValue(e,s){var n;if(!e.extractor)return s;if(e.extractor.type==="pwned")return await Re.extractorPwned(s.value)?s:void 0;if(e.extractor.type==="url"){const r=new RegExp(e.extractor.value,"i"),i=(n=s.url.match(r))==null?void 0:n[0];return i===void 0?void 0:{...s,value:i}}return s}static async extractorPwned(e){try{return(await ih(e)).feedback.warning==="pwned"}catch{return!1}}static async sha256(e){const s=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(n)).map(a=>a.toString(16).padStart(2,"0")).join("")}}class mh{constructor(e,s){this.messageService=e,this.guardAlertController=s}init(){this.messageService.subscribe({"get-guard-enable-state":this.getGuardEnableState.bind(this),"get-guard-rules":this.getGuardRules.bind(this),"send-guard-action":this.sendGuardAction.bind(this)})}async getGuardEnableState(){return{...await this.guardAlertController.getGuardEnableState(),type:"get-guard-enable-state"}}async getGuardRules(e){return{...await this.guardAlertController.getGuardRules(e),type:"get-guard-rules"}}async sendGuardAction(e){return{...await this.guardAlertController.sendGuardAction(e),type:"send-guard-action"}}}const yh=new Re(gr,fe),wh=new mh(Ve,yh);class bh{constructor(e){this.lockScreenService=e}async getLockScreenShowState(){return await Promise.resolve(),{success:!0,data:this.lockScreenService.showState}}async closeLockScreen(){return await this.lockScreenService.iterateShowState(),{success:!0,data:{success:!0}}}}class Sh{constructor(e,s){this.messageService=e,this.lockScreenController=s}init(){this.messageService.subscribe({"get-lock-screen-show-state":this.getLockScreenShowState.bind(this),"close-lock-screen":this.closeLockScreen.bind(this)})}async getLockScreenShowState(){return{...await this.lockScreenController.getLockScreenShowState(),type:"get-lock-screen-show-state"}}async closeLockScreen(){return{...await this.lockScreenController.closeLockScreen(),type:"close-lock-screen"}}}const vh=new bh(_n),xh=new Sh(Ve,vh);class Eh{constructor(e,s,n,r,i,a,o){this.globalStateService=e,this.i18nService=s,this.accessService=n,this.notificationService=r,this.analyticsService=i,this.userService=a,this.abTestsService=o}async execute(e){e.reason==="install"&&(!await this.globalStateService.getCookiesUdid()&&await this.abTestsService.initExperiments("install"),await this.onInstall()),e.previousVersion===B.runtime.getManifest().version||(await this.abTestsService.initExperiments("update"),e.reason==="update"&&await this.onUpdate(),this.collectInstalledExtensions().catch(()=>{}))}async onInstall(){await this.globalStateService.appBooted;const e=this.globalStateService.udid.type==="new"?"install":"reinstall";this.analyticsService.sendEvent({types:["google-analytics","amplitude"],name:"launch_first_time",data:{install_type:e}}),this.analyticsService.sendEvent({types:["aws-kinesis"],name:"install_completed",data:{event_properties__install_datetime:Date.now()}}),e==="reinstall"&&this.analyticsService.sendEvent({types:["google-analytics","amplitude","aws-kinesis"],name:"reinstall_app_launch"}),await this.accessService.setUninstallURL(),await this.accessService.proceedToWebsitePage({page:"install",params:{utm_campaign:"welcome"}})}async onUpdate(){if(await this.globalStateService.appBooted,this.analyticsService.sendEvent({types:["google-analytics","amplitude","aws-kinesis"],name:"update_app_version"}),!this.userService.hasPermitions("domain","premium")){const e=B.runtime.getManifest();await this.notificationService.notify({options:{title:this.i18nService.t("base:update-notification.title"),message:this.i18nService.t("base:update-notification.message",{tr_version:`v${e.version}`})},callback:"extension-updated"});const s=60*24*60*60*1e3;this.globalStateService.installedAt+s<Date.now()&&await this.accessService.proceedToWebsitePage({page:"update",params:{utm_campaign:"update_page"}})}}async collectInstalledExtensions(){const e=new Date("2024-01-01").getTime();if(!(this.globalStateService.installedAt>e))return;(await B.management.getAll()).filter(i=>i.type==="extension"&&i.id!==B.runtime.id).forEach(i=>{this.analyticsService.sendEvent({types:["aws-kinesis"],name:"user_external_extension_installed",data:{event_properties__external_extension_enabled:i.enabled,event_properties__external_extension_id:i.id,event_properties__external_extension_install_type:i.installType,event_properties__external_extension_name:i.name,event_properties__external_extension_short_name:i.shortName??"unknown",event_properties__external_extension_version:i.version}})})}}class Ah{constructor(e,s,n,r){this.globalStateService=e,this.connectionService=s,this.analyticsService=n,this.connectionController=r}async execute(){await this.globalStateService.appBooted,await this.connectionController.disconnect({disconnectReason:"autoconnect_off",failedReason:"n/a"}),this.connectionService.useAutoConnect&&await this.connectionController.connect(),this.analyticsService.sendEvent({types:["aws-kinesis"],name:"session_start"})}}const Ch=new Eh(se,Ie,gt,ve,ie,fe,Ke),Rh=new Ah(se,Pe,ie,Zt);B.runtime.onInstalled.addListener(t=>{Ch.execute(t).catch(()=>{})});B.runtime.onStartup.addListener(()=>{Rh.execute().catch(()=>{})});class _h{constructor(e,s){A(this,"authErrorMap",new Map);this.proxyService=e,this.analyticsService=s}async execute(e,s){const n=this.incrementAuthErrorCount(e.requestId);if(n>1)return n===2&&setTimeout(()=>{this.analyticsService.sendEvent({types:["google-analytics"],name:"auth_error_screen_shown",data:{server_address:e.challenger.host,server_port:e.challenger.port}})},1e3),this.removeAuthErrorCount(e.requestId),s&&s({cancel:!0}),{cancel:!0};if(!(await this.proxyService.getServerConfigList()).flatMap(o=>o.addresses).includes(e.challenger.host))return s&&s({}),{};const a=await this.proxyService.getAuthCredentials();return a?(s&&s({authCredentials:a}),{authCredentials:a}):(setTimeout(()=>{this.analyticsService.sendEvent({types:["google-analytics"],name:"auth_error_credentials_empty",data:{server_address:e.challenger.host,server_port:e.challenger.port}})},100),s&&s({}),{})}incrementAuthErrorCount(e){const n=(this.authErrorMap.get(e)??0)+1;return this.authErrorMap.set(e,n),n}removeAuthErrorCount(e){this.authErrorMap.delete(e)}}const Dh=new _h(Vt,ie);B.webRequest.onAuthRequired.addListener((t,e)=>Dh.execute(t,e),{urls:["<all_urls>"]},["asyncBlocking"]);class kh{constructor(e){this.connectionController=e}async execute(e){(e.levelOfControl==="not_controllable"||e.levelOfControl==="controlled_by_other_extensions")&&await this.connectionController.disconnect({disconnectReason:"controlled_by_other_extensions",failedReason:"n/a"})}}const Th=new kh(Zt);B.proxy.settings.onChange.addListener(t=>{Th.execute(t).catch(()=>{})});function Mh(){const t=Yt(navigator.userAgent);if(!t.os.name)return"other";const e=t.os.name.toLocaleLowerCase();return e.includes("linux")?"linux":e.includes("mac")?"macos":e.includes("windows")?"windows":"other"}class Ih{constructor(e,s,n,r,i,a){A(this,"actionMap",{"download-app":this.callbackDownloadApp.bind(this),"extension-updated":this.callbackExtensionUpdated.bind(this)});this.globalStateService=e,this.notificationService=s,this.appService=n,this.userService=r,this.accessService=i,this.analyticsService=a}async execute(e){var n,r;await this.globalStateService.appBooted;const s=this.notificationService.getCallbackSettings(e);s&&s.callback&&await((r=(n=this.actionMap)[s.callback])==null?void 0:r.call(n)),await this.notificationService.removeCallbackSettings(e)}async callbackDownloadApp(){const e=Mh(),s=await this.appService.getDownloadLink(e);B.tabs.create({url:s}).catch(()=>{}),this.analyticsService.sendEvent({types:["google-analytics","amplitude"],name:"notify_popup_pc_download_click_free_download"})}async callbackExtensionUpdated(){this.userService.hasPermitions("domain","premium")||await this.accessService.proceedToWebsitePage({page:"pricing",params:{utm_campaign:"update_notification"}}),this.analyticsService.sendEvent({types:["google-analytics","amplitude"],name:"update_popup_click"})}}const Ph=new Ih(se,ve,Me,fe,gt,ie);B.notifications.onClicked.addListener(t=>{Ph.execute(t).catch(()=>{})});(async()=>{jl.init(),$r.init(),Ir.init(),Pr.init(),Gl.init(),wh.init(),xh.init(),await se.boot(),await Ie.boot(),await ie.boot(),await Ke.boot(),await Vt.boot(),await gt.boot(),await En.boot(),await An.boot(),await Me.boot(),await Pe.boot(),await Rn.boot(),await Br.boot(),await ve.boot(),await fe.boot(),await Cn.boot(),await gr.boot(),await _n.boot(),await Or.init(),await Zt.init(),await Ve.boot(),await wt.boot(),await ne.boot(),await kl.boot(),await Pl.boot(),se.globalboot()})().catch(t=>{typeof t=="object"&&t!==null&&"message"in t&&"stack"in t?ne.available?ne.send({types:["google-analytics"],name:"background_boot_error",data:{error_message:String(t.message),error_stack:String(t.stack)}}).catch(()=>{}):ne.boot().then(()=>ne.send({types:["google-analytics"],name:"background_boot_error",data:{error_message:String(t.message),error_stack:String(t.stack)}})).catch(()=>{}):ne.available?ne.send({types:["google-analytics"],name:"background_boot_error",data:{error_message:String(t),error_stack:String(t)}}).catch(()=>{}):ne.boot().then(()=>ne.send({types:["google-analytics"],name:"background_boot_error",data:{error_message:String(t),error_stack:String(t)}})).catch(()=>{})});
